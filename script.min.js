"use strict";(function p(c,e,t){function r(s,i){if(!e[s]){if(!c[s]){var o="function"==typeof require&&require;if(!i&&o)return o(s,!0);if(n)return n(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var u=e[s]={exports:{}};c[s][0].call(u.exports,function(t){var e=c[s][1][t];return r(e?e:t)},u,u.exports,p,c,e,t)}return e[s].exports}for(var n="function"==typeof require&&require,a=0;a<t.length;a++)r(t[a]);return r})({1:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../function-builder-base"),o=e("./function-node");t.exports=function(e){function t(){n(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.Node=o,e}return a(t,e),s(t,[{key:"polyfillStandardFunctions",value:function(){}}]),t}(i)},{"../function-builder-base":6,"./function-node":2}],2:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../function-node-base"),o=e("../../core/utils");t.exports=function(e){function t(){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"generate",value:function(){return this.debug&&console.log(this),this.functionStringArray=this.astGeneric(this.getJsAST(),[],this),this.functionString=this.functionStringArray.join("").trim(),this.functionString}},{key:"getFunctionPrototypeString",value:function(){return this.webGlFunctionPrototypeString?this.webGlFunctionPrototypeString:this.webGlFunctionPrototypeString=this.generate()}},{key:"astGeneric",value:function(e,t,n){if(null===e)throw this.astErrorOutput("NULL ast",e,n);else{if(Array.isArray(e)){for(var r=0;r<e.length;r++)this.astGeneric(e[r],t,n);return t}switch(e.type){case"FunctionDeclaration":return this.astFunctionDeclaration(e,t,n);case"FunctionExpression":return this.astFunctionExpression(e,t,n);case"ReturnStatement":return this.astReturnStatement(e,t,n);case"Literal":return this.astLiteral(e,t,n);case"BinaryExpression":return this.astBinaryExpression(e,t,n);case"Identifier":return this.astIdentifierExpression(e,t,n);case"AssignmentExpression":return this.astAssignmentExpression(e,t,n);case"ExpressionStatement":return this.astExpressionStatement(e,t,n);case"EmptyStatement":return this.astEmptyStatement(e,t,n);case"BlockStatement":return this.astBlockStatement(e,t,n);case"IfStatement":return this.astIfStatement(e,t,n);case"BreakStatement":return this.astBreakStatement(e,t,n);case"ContinueStatement":return this.astContinueStatement(e,t,n);case"ForStatement":return this.astForStatement(e,t,n);case"WhileStatement":return this.astWhileStatement(e,t,n);case"VariableDeclaration":return this.astVariableDeclaration(e,t,n);case"VariableDeclarator":return this.astVariableDeclarator(e,t,n);case"ThisExpression":return this.astThisExpression(e,t,n);case"SequenceExpression":return this.astSequenceExpression(e,t,n);case"UnaryExpression":return this.astUnaryExpression(e,t,n);case"UpdateExpression":return this.astUpdateExpression(e,t,n);case"LogicalExpression":return this.astLogicalExpression(e,t,n);case"MemberExpression":return this.astMemberExpression(e,t,n);case"CallExpression":return this.astCallExpression(e,t,n);case"ArrayExpression":return this.astArrayExpression(e,t,n);case"DebuggerStatement":return this.astDebuggerStatement(e,t,n);}throw this.astErrorOutput("Unknown ast type : "+e.type,e,n)}}},{key:"astFunctionDeclaration",value:function(e,t){return this.addFunction&&this.addFunction(null,o.getAstString(this.jsFunctionString,e)),t}},{key:"astFunctionExpression",value:function(e,t,n){if(!n.isRootKernel){t.push("function"),n.kernalAst=e,t.push(" "),t.push(n.functionName),t.push("(");for(var r,a=0;a<n.paramNames.length;++a)r=n.paramNames[a],0<a&&t.push(", "),t.push(" "),t.push("user_"),t.push(r);t.push(") {\n")}for(var s=0;s<e.body.body.length;++s)this.astGeneric(e.body.body[s],t,n),t.push("\n");return n.isRootKernel||t.push("}\n"),t}},{key:"astReturnStatement",value:function(e,t,n){return n.isRootKernel?(t.push("kernelResult = "),this.astGeneric(e.argument,t,n),t.push(";")):n.isSubKernel?(t.push(n.functionName+"Result = "),this.astGeneric(e.argument,t,n),t.push(";"),t.push("return "+n.functionName+"Result;")):(t.push("return "),this.astGeneric(e.argument,t,n),t.push(";")),t}},{key:"astLiteral",value:function(e,t,n){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e,n);return t.push(e.value),t}},{key:"astBinaryExpression",value:function(e,t,n){return t.push("("),this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t.push(")"),t}},{key:"astIdentifierExpression",value:function(e,t,n){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e,n);switch(e.name){case"gpu_threadX":t.push("threadId.x");break;case"gpu_threadY":t.push("threadId.y");break;case"gpu_threadZ":t.push("threadId.z");break;case"gpu_outputX":t.push("uOutputDim.x");break;case"gpu_outputY":t.push("uOutputDim.y");break;case"gpu_outputZ":t.push("uOutputDim.z");break;default:if(this.constants&&this.constants.hasOwnProperty(e.name))t.push("constants_"+e.name);else{var r=n.getUserParamName(e.name);null===r?t.push("user_"+e.name):t.push("user_"+r)}}return t}},{key:"astForStatement",value:function(e,t,n){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statment",e,n);if(e.test&&"BinaryExpression"===e.test.type){if(("Identifier"===e.test.right.type||"Literal"===e.test.right.type)&&"<"===e.test.operator&&!1===this.isIdentifierConstant(e.test.right.name)){if(this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),t.push("for ("),this.astGeneric(e.init,t,n),";"!==t[t.length-1]&&t.push(";"),this.astGeneric(e.test.left,t,n),t.push(e.test.operator),t.push("LOOP_MAX"),t.push(";"),this.astGeneric(e.update,t,n),t.push(")"),t.push("{\n"),t.push("if ("),this.astGeneric(e.test.left,t,n),t.push(e.test.operator),this.astGeneric(e.test.right,t,n),t.push(") {\n"),"BlockStatement"===e.body.type)for(var r=0;r<e.body.body.length;r++)this.astGeneric(e.body.body[r],t,n);else this.astGeneric(e.body,t,n);return t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}if(e.init.declarations){var a=JSON.parse(JSON.stringify(e.init.declarations)),s=e.update.argument;if(!Array.isArray(a)||1>a.length)throw console.log(this.jsFunctionString),new Error("Error: Incompatible for loop declaration");if(1<a.length){for(var o,p=null,u=0;u<a.length;u++)o=a[u],o.id.name===s.name?(p=o,a.splice(u,1)):(t.push("var "),this.astGeneric(o,t,n),t.push(";"));t.push("for (let "),this.astGeneric(p,t,n),t.push(";")}else t.push("for ("),this.astGeneric(e.init,t,n);return this.astGeneric(e.test,t,n),t.push(";"),this.astGeneric(e.update,t,n),t.push(")"),this.astGeneric(e.body,t,n),t}}throw this.astErrorOutput("Invalid for statement",e,n)}},{key:"astWhileStatement",value:function(e,t,n){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e,n);return t.push("for (let i = 0; i < LOOP_MAX; i++) {"),t.push("if ("),this.astGeneric(e.test,t,n),t.push(") {\n"),this.astGeneric(e.body,t,n),t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astAssignmentExpression",value:function(e,t,n){return this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t}},{key:"astEmptyStatement",value:function(e,t){return t}},{key:"astBlockStatement",value:function(e,t,n){t.push("{\n");for(var r=0;r<e.body.length;r++)this.astGeneric(e.body[r],t,n);return t.push("}\n"),t}},{key:"astExpressionStatement",value:function(e,t,n){return this.astGeneric(e.expression,t,n),t.push(";\n"),t}},{key:"astVariableDeclaration",value:function(e,t,n){t.push("var ");for(var r=0;r<e.declarations.length;r++)0<r&&t.push(","),this.astGeneric(e.declarations[r],t,n);return t.push(";"),t}},{key:"astVariableDeclarator",value:function(e,t,n){return this.astGeneric(e.id,t,n),null!==e.init&&(t.push("="),this.astGeneric(e.init,t,n)),t}},{key:"astIfStatement",value:function(e,t,n){return t.push("if ("),this.astGeneric(e.test,t,n),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t,n):(t.push(" {\n"),this.astGeneric(e.consequent,t,n),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type?this.astGeneric(e.alternate,t,n):(t.push(" {\n"),this.astGeneric(e.alternate,t,n),t.push("\n}\n"))),t}},{key:"astBreakStatement",value:function(e,t){return t.push("break;\n"),t}},{key:"astContinueStatement",value:function(e,t){return t.push("continue;\n"),t}},{key:"astLogicalExpression",value:function(e,t,n){return t.push("("),this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t.push(")"),t}},{key:"astUpdateExpression",value:function(e,t,n){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t,n)):(this.astGeneric(e.argument,t,n),t.push(e.operator)),t}},{key:"astUnaryExpression",value:function(e,t,n){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t,n)):(this.astGeneric(e.argument,t,n),t.push(e.operator)),t}},{key:"astThisExpression",value:function(e,t){return t.push("_this"),t}},{key:"astMemberExpression",value:function(e,t,n){if(!e.computed){var r=this.astMemberExpressionUnroll(e);"Identifier"===e.property.type&&e.computed&&(r="user_"+r),0===r.indexOf("this")&&(r="_"+r),"_this.output.x"===r?t.push(this.output[0]):"_this.output.y"===r?t.push(this.output[1]):"_this.output.z"===r?t.push(this.output[2]):t.push(r)}else if("Identifier"===e.object.type)this.astGeneric(e.object,t,n),t.push("["),this.astGeneric(e.property,t,n),t.push("]");else{this.astGeneric(e.object,t,n);var a=t.pop();t.push("]["),this.astGeneric(e.property,t,n),t.push(a)}return t}},{key:"astSequenceExpression",value:function(e,t,n){for(var r=0;r<e.expressions.length;r++)0<r&&t.push(","),this.astGeneric(e.expressions,t,n);return t}},{key:"astCallExpression",value:function(e,t,n){if(e.callee){var r=this.astMemberExpressionUnroll(e.callee);0>n.calledFunctions.indexOf(r)&&n.calledFunctions.push(r),n.hasOwnProperty("funcName")||(n.calledFunctionsArguments[r]=[]);var a=[];n.calledFunctionsArguments[r].push(a),t.push(r),t.push("(");for(var s,o=0;o<e.arguments.length;++o)if(s=e.arguments[o],0<o&&t.push(", "),this.astGeneric(s,t,n),"Identifier"===s.type){var p=n.paramNames.indexOf(s.name);-1===p?a.push(null):a.push({name:s.name,type:n.paramTypes[p]})}else a.push(null);return t.push(")"),t}throw this.astErrorOutput("Unknown CallExpression",e,n)}},{key:"astArrayExpression",value:function(e,t,n){var r=e.elements.length;t.push("new Float32Array(");for(var a=0;a<r;++a){0<a&&t.push(", ");var s=e.elements[a];this.astGeneric(s,t,n)}return t.push(")"),t}},{key:"astDebuggerStatement",value:function(e,t){return t.push("debugger;"),t}}],[{key:"astFunctionPrototype",value:function(e,t,n){if(n.isRootKernel||n.isSubKernel)return t;t.push(n.returnType),t.push(" "),t.push(n.functionName),t.push("(");for(var r=0;r<n.paramNames.length;++r)0<r&&t.push(", "),t.push(n.paramTypes[r]),t.push(" "),t.push("user_"),t.push(n.paramNames[r]);return t.push(");\n"),t}}]),t}(i)},{"../../core/utils":25,"../function-node-base":7}],3:[function(e,t){'use strict';var n=e("../../core/utils"),r=e("../kernel-run-shortcut");t.exports=function(e,t){return"() => {\n    "+r.toString()+";\n    const utils = {\n      allPropertiesOf: function "+n.allPropertiesOf.toString()+",\n      clone: function "+n.clone.toString()+",\n      /*splitArray: function "+n.splitArray.toString()+",\n      getArgumentType: function "+n.getArgumentType.toString()+",\n      getOutput: function "+n.getOutput.toString()+",\n      dimToTexSize: function "+n.dimToTexSize.toString()+",\n      copyFlatten: function "+n.copyFlatten.toString()+",\n      flatten: function "+n.flatten.toString()+",\n      systemEndianness: '"+n.systemEndianness()+"',\n      initWebGl: function "+n.initWebGl.toString()+",\n      isArray: function "+n.isArray.toString()+"*/\n    };\n    class "+(t||"Kernel")+" {\n      constructor() {        \n        this.argumentsLength = 0;\n        this._canvas = null;\n        this._webGl = null;\n        this.built = false;\n        this.program = null;\n        this.paramNames = "+JSON.stringify(e.paramNames)+";\n        this.paramTypes = "+JSON.stringify(e.paramTypes)+";\n        this.texSize = "+JSON.stringify(e.texSize)+";\n        this.output = "+JSON.stringify(e.output)+";\n        this._kernelString = `"+e._kernelString+"`;\n        this.output = "+JSON.stringify(e.output)+";\n\t\t    this.run = function() {\n          this.run = null;\n          this.build();\n          return this.run.apply(this, arguments);\n        }.bind(this);\n        this.thread = {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n      }\n      setCanvas(canvas) { this._canvas = canvas; return this; }\n      setWebGl(webGl) { this._webGl = webGl; return this; }\n      "+e.build.toString()+"\n      run () { "+e.kernelString+" }\n      getKernelString() { return this._kernelString; }\n    };\n    return kernelRunShortcut(new Kernel());\n  };"}},{"../../core/utils":25,"../kernel-run-shortcut":9}],4:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../kernel-base"),o=e("../../core/utils"),p=e("./kernel-string");t.exports=function(e){function t(e,a){n(this,t);var s=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return s._fnBody=o.getFunctionBodyFromString(e),s._fn=null,s.run=null,s._canvasCtx=null,s._imageData=null,s._colorData=null,s._kernelString=null,s.thread={x:0,y:0,z:0},s.run=function(){return this.run=null,this.build.apply(this,arguments),this.run.apply(this,arguments)}.bind(s),s}return a(t,e),s(t,[{key:"validateOptions",value:function(){if(!this.output||0===this.output.length){if(1!==arguments.length)throw"Auto dimensions only supported for kernels with only one input";var e=o.getArgumentType(arguments[0]);if("Array"===e)this.output=o.getDimensions(e);else if("Texture"===e)this.output=arguments[0].output;else throw"Auto dimensions not supported for input type: "+e}}},{key:"build",value:function(){this.setupParams(arguments);for(var e=this.threadDim=o.clone(this.output);3>e.length;)e.push(1);if(this.graphical){var t=this.getCanvas();t.width=e[0],t.height=e[1],this._canvasCtx=t.getContext("2d"),this._imageData=this._canvasCtx.createImageData(e[0],e[1]),this._colorData=new Uint8ClampedArray(4*(e[0]*e[1]))}var n=this.getKernelString();this.debug&&(console.log("Options:"),console.dir(this),console.log("Function output:"),console.log(n)),this.kernelString=n,this.run=new Function([],n).bind(this)()}},{key:"color",value:function(e,t,n,s){"undefined"==typeof s&&(s=1),e=Math.floor(255*e),t=Math.floor(255*t),n=Math.floor(255*n),s=Math.floor(255*s);var i=this.output[0],o=this.output[1],p=this.thread.x,u=o-this.thread.y-1,l=p+u*i;this._colorData[4*l+0]=e,this._colorData[4*l+1]=t,this._colorData[4*l+2]=n,this._colorData[4*l+3]=s}},{key:"getKernelString",value:function(){var e=this;if(null!==this._kernelString)return this._kernelString;for(var t=this.functionBuilder,n=this.threadDim||(this.threadDim=o.clone(this.output));3>n.length;)n.push(1);if(t.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations},this.paramNames,this.paramTypes),t.addFunctions(this.functions,{constants:this.constants,output:this.output}),null!==this.subKernels){this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[];for(var r,a=0;a<this.subKernels.length;a++)r=this.subKernels[a],t.addSubKernel(r,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations}),this.subKernelOutputVariableNames.push(r.name+"Result")}else if(null!==this.subKernelProperties){this.subKernelOutputVariableNames=[];var s=0;for(var u in this.subKernelProperties)if(this.subKernelProperties.hasOwnProperty(u)){var p=this.subKernelProperties[u];t.addSubKernel(p),this.subKernelOutputVariableNames.push(p.name+"Result"),s++}}var l=t.getPrototypes(),c=l.shift(),d=this._kernelString="\n\t\tvar LOOP_MAX = "+this._getLoopMaxString()+";\n\t\tvar _this = this;\n  "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"  var "+e+" = null;\n"}).join(""))+"\n    return function ("+this.paramNames.map(function(e){return"user_"+e}).join(", ")+") {\n    var ret = new Array("+n[2]+");\n  "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"  "+e+"Z = new Array("+n[2]+");\n"}).join(""))+"\n    for (this.thread.z = 0; this.thread.z < "+n[2]+"; this.thread.z++) {\n      ret[this.thread.z] = new Array("+n[1]+");\n  "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"    "+e+"Z[this.thread.z] = new Array("+n[1]+");\n"}).join(""))+"\n      for (this.thread.y = 0; this.thread.y < "+n[1]+"; this.thread.y++) {\n        ret[this.thread.z][this.thread.y] = new Array("+n[0]+");\n  "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"      "+e+"Z[this.thread.z][this.thread.y] = new Array("+n[0]+");\n"}).join(""))+"\n        for (this.thread.x = 0; this.thread.x < "+n[0]+"; this.thread.x++) {\n          var kernelResult;\n          "+c+"\n          ret[this.thread.z][this.thread.y][this.thread.x] = kernelResult;\n"+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"        "+e+"Z[this.thread.z][this.thread.y][this.thread.x] = "+e+";\n"}).join(""))+"\n          }\n        }\n      }\n      \n      if (this.graphical) {\n        this._imageData.data.set(this._colorData);\n        this._canvasCtx.putImageData(this._imageData, 0, 0);\n        return;\n      }\n      \n      if (this.output.length === 1) {\n        ret = ret[0][0];\n"+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"    "+e+" = "+e+"Z[0][0];\n"}).join(""))+"\n      \n    } else if (this.output.length === 2) {\n      ret = ret[0];\n      "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"    "+e+" = "+e+"Z[0];\n"}).join(""))+"\n    }\n    \n    "+(null===this.subKernelOutputVariableNames?"return ret;\n":null===this.subKernels?"return {\n        result: ret,\n        "+Object.keys(this.subKernelProperties).map(function(t,n){return t+": "+e.subKernelOutputVariableNames[n]}).join(",\n")+"\n      };":"var result = [\n        "+this.subKernelOutputVariableNames.map(function(e){return""+e}).join(",\n")+"\n      ];\n      result.result = ret;\n      return result;\n")+"\n    "+(0<l.length?l.join("\n"):"")+"\n    }.bind(this);";return d}},{key:"toString",value:function(){return p(this)}},{key:"precompileKernelObj",value:function(){var e=this.threadDim||(this.threadDim=o.clone(this.output));return{threadDim:e}}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+";\n":" 1000;\n"}}],[{key:"compileKernel",value:function(e){for(var t=e.threadDim;3>t.length;)t.push(1)}}]),t}(i)},{"../../core/utils":25,"../kernel-base":8,"./kernel-string":3}],5:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../../core/utils"),o=e("../runner-base"),p=e("./kernel"),u=e("./function-builder");t.exports=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,new u,e));return a.Kernel=p,a.kernel=null,a}return a(t,e),s(t,[{key:"getMode",value:function(){return"cpu"}}]),t}(o)},{"../../core/utils":25,"../runner-base":10,"./function-builder":1,"./kernel":4}],6:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=function(){function e(t){n(this,e),this.nodeMap={},this.nativeFunctions={},this.gpu=t,this.rootKernel=null,this.Node=null}return r(e,[{key:"addNativeFunction",value:function(e,t){this.nativeFunctions[e]=t}},{key:"addFunction",value:function(e,t,n,r,a){this.addFunctionNode(new this.Node(e,t,n,r,a).setAddFunction(this.addFunction.bind(this)))}},{key:"addFunctions",value:function(e,t){if(e)if(Array.isArray(e))for(var n=0;n<e.length;n++)this.addFunction(null,e[n],t);else for(var r in e)this.addFunction(r,e[r],t)}},{key:"addNativeFunctions",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this.addNativeFunction(t,e[t])}},{key:"addFunctionNode",value:function(e){this.nodeMap[e.functionName]=e,e.isRootKernel&&(this.rootKernel=e)}},{key:"traceFunctionCalls",value:function(e,t,n){e=e||"kernel",t=t||[];var r=this.nodeMap[e];if(r){var a=t.indexOf(e);if(-1===a){t.push(e),n&&(r.parent=n),r.getFunctionString();for(var s=0;s<r.calledFunctions.length;++s)this.traceFunctionCalls(r.calledFunctions[s],t,r)}else{var o=t.splice(a,1)[0];t.push(o)}}return this.nativeFunctions[e]&&(0<=t.indexOf(e)||t.push(e)),t}},{key:"addKernel",value:function(e,t,n,r){var a=new this.Node("kernel",e,t,r);return a.setAddFunction(this.addFunction.bind(this)),a.paramNames=n,a.paramTypes=r,a.isRootKernel=!0,this.addFunctionNode(a),a}},{key:"addSubKernel",value:function(e,t,n,r){var a=new this.Node(null,e,t,n,r);return a.setAddFunction(this.addFunction.bind(this)),a.isSubKernel=!0,this.addFunctionNode(a),a}},{key:"getPrototypeString",value:function(e){return this.getPrototypes(e).join("\n")}},{key:"getPrototypes",value:function(e){return this.rootKernel.generate(),e?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(e,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.nodeMap))}},{key:"getStringFromFunctionNames",value:function(e){for(var t,n=[],r=0;r<e.length;++r)t=this.nodeMap[e[r]],t&&n.push(this.nodeMap[e[r]].getFunctionString());return n.join("\n")}},{key:"getPrototypesFromFunctionNames",value:function(e,t){for(var n=[],r=0;r<e.length;++r){var a=e[r],s=this.nodeMap[a];s?n.push(s.getFunctionPrototypeString(t)):this.nativeFunctions[a]&&n.push(this.nativeFunctions[a])}return n}},{key:"getPrototypeStringFromFunctionNames",value:function(e,t){return this.getPrototypesFromFunctionNames(e,t).toString()}},{key:"getString",value:function(e,t){return void 0===t&&(t={}),e?this.getStringFromFunctionNames(this.traceFunctionCalls(e,[],t).reverse(),t):this.getStringFromFunctionNames(Object.keys(this.nodeMap),t)}},{key:"polyfillStandardFunctions",value:function(){throw new Error("polyfillStandardFunctions not defined on base function builder")}}]),e}()},{}],7:[function(require,module,exports){'use strict';function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),utils=require("../core/utils"),acorn=require("acorn");module.exports=function(){function BaseFunctionNode(e,t,n,r,a){if(_classCallCheck(this,BaseFunctionNode),this.calledFunctions=[],this.calledFunctionsArguments={},this.initVariables=[],this.readVariables=[],this.writeVariables=[],this.addFunction=null,this.isRootKernel=!1,this.isSubKernel=!1,this.parent=null,this.debug=null,this.prototypeOnly=null,this.constants=null,this.output=null,n&&(n.hasOwnProperty("debug")&&(this.debug=n.debug),n.hasOwnProperty("prototypeOnly")&&(this.prototypeOnly=n.prototypeOnly),n.hasOwnProperty("constants")&&(this.constants=n.constants),n.hasOwnProperty("output")&&(this.output=n.output),n.hasOwnProperty("loopMaxIterations")&&(this.loopMaxIterations=n.loopMaxIterations)),!t)throw"jsFunction, parameter is missing";if(this.jsFunctionString=t.toString(),!utils.isFunctionString(this.jsFunctionString))throw console.error("jsFunction, to string conversion check failed: not a function?",this.jsFunctionString),"jsFunction, to string conversion check failed: not a function?";if(this.jsFunction=utils.isFunction(t)?t:null,this.functionName=e||t&&t.name||utils.getFunctionNameFromString(this.jsFunctionString),!this.functionName)throw"jsFunction, missing name argument or value";if(this.paramNames=utils.getParamNamesFromString(this.jsFunctionString),!r)this.paramTypes=[];else if(Array.isArray(r)){if(r.length!==this.paramNames.length)throw"Invalid argument type array length, against function length -> ("+r.length+","+this.paramNames.length+")";this.paramTypes=r}else if("object"===("undefined"==typeof r?"undefined":_typeof(r))){var s=Object.keys(r);if(r.hasOwnProperty("returns")&&(this.returnType=r.returns,s.splice(s.indexOf("returns"),1)),0<s.length&&s.length!==this.paramNames.length)throw"Invalid argument type array length, against function length -> ("+s.length+","+this.paramNames.length+")";else this.paramTypes=this.paramNames.map(function(e){return r.hasOwnProperty(e)?r[e]:"float"})}this.returnType||(this.returnType=a||"float")}return _createClass(BaseFunctionNode,[{key:"isIdentifierConstant",value:function(e){return!!this.constants&&this.constants.hasOwnProperty(e)}},{key:"setAddFunction",value:function(e){return this.addFunction=e,this}},{key:"getJsFunction",value:function(){if(this.jsFunction)return this.jsFunction;if(this.jsFunctionString)return this.jsFunction=eval(this.jsFunctionString),this.jsFunction;throw"Missing jsFunction, and jsFunctionString parameter"}},{key:"astMemberExpressionUnroll",value:function(e,t){if("Identifier"===e.type)return e.name;if("ThisExpression"===e.type)return"this";if("MemberExpression"===e.type&&e.object&&e.property)return e.object.hasOwnProperty("name")&&"_"===e.object.name[0]?this.astMemberExpressionUnroll(e.property,t):this.astMemberExpressionUnroll(e.object,t)+"."+this.astMemberExpressionUnroll(e.property,t);if(e.hasOwnProperty("expressions")){var n=e.expressions[0];if("Literal"===n.type&&0===n.value&&2===e.expressions.length)return this.astMemberExpressionUnroll(e.expressions[1])}throw this.astErrorOutput("Unknown CallExpression_unroll",e,t)}},{key:"getJsAST",value:function(e){if(this.jsFunctionAST)return this.jsFunctionAST;if(e=e||acorn,null===e)throw"Missing JS to AST parser";var t=e.parse("var "+this.functionName+" = "+this.jsFunctionString+";",{locations:!0});if(null===t)throw"Failed to parse JS code";var n=t.body[0].declarations[0].init;return this.jsFunctionAST=n,n}},{key:"getFunctionString",value:function(){return this.generate(),this.functionString}},{key:"setFunctionString",value:function(e){this.functionString=e}},{key:"getParamType",value:function(e){var t=this.paramNames.indexOf(e);if(-1===t)return null;if(!this.parent)return null;if(this.paramTypes[t])return this.paramTypes[t];for(var n,r=this.parent.calledFunctionsArguments[this.functionName],a=0;a<r.length;a++)if(n=r[a],null!==n[t])return this.paramTypes[t]=n[t].type;return null}},{key:"getUserParamName",value:function(e){var t=this.paramNames.indexOf(e);if(-1===t)return null;if(!this.parent)return null;for(var n,r=this.parent.calledFunctionsArguments[this.functionName],a=0;a<r.length;a++)if(n=r[a],null!==n[t])return n[t].name;return null}},{key:"generate",value:function(){throw new Error("generate not defined on BaseFunctionNode")}},{key:"astErrorOutput",value:function(e,t,n){return console.error(utils.getAstString(this.jsFunctionString,t)),console.error(e,t,n),e}},{key:"astDebuggerStatement",value:function(e,t){return t}}]),BaseFunctionNode}()},{"../core/utils":25,acorn:27}],8:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../core/utils");t.exports=function(){function e(t,r){for(var s in n(this,e),this.paramNames=a.getParamNamesFromString(t),this.fnString=t,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.wraparound=null,this.hardcodeConstants=null,this.outputToTexture=null,this.texSize=null,this._canvas=null,this._webGl=null,this.threadDim=null,this.floatTextures=null,this.floatOutput=null,this.floatOutputForce=null,this.addFunction=null,this.functions=null,this.nativeFunctions=null,this.copyData=!0,this.subKernels=null,this.subKernelProperties=null,this.subKernelNames=null,this.subKernelOutputVariableNames=null,this.functionBuilder=null,this.paramTypes=null,r)r.hasOwnProperty(s)&&this.hasOwnProperty(s)&&(this[s]=r[s]);r.hasOwnProperty("canvas")&&(this._canvas=r.canvas),r.hasOwnProperty("output")&&this.setOutput(r.output),this._canvas||(this._canvas=a.initCanvas())}return r(e,[{key:"build",value:function(){throw new Error("\"build\" not defined on Base")}},{key:"setupParams",value:function(e){for(var t=this.paramTypes=[],n=0;n<e.length;n++){var r=e[n],s=a.getArgumentType(r);t.push(s)}}},{key:"setAddFunction",value:function(e){return this.addFunction=e,this}},{key:"setFunctions",value:function(e){return this.functions=e,this}},{key:"setOutput",value:function(e){return this.output=e.hasOwnProperty("x")?e.hasOwnProperty("y")?e.hasOwnProperty("z")?[e.x,e.y,e.z]:[e.x,e.y]:[e.x]:e,this}},{key:"setDebug",value:function(e){return this.debug=e,this}},{key:"setGraphical",value:function(e){return this.graphical=e,this}},{key:"setLoopMaxIterations",value:function(e){return this.loopMaxIterations=e,this}},{key:"setConstants",value:function(e){return this.constants=e,this}},{key:"setWraparound",value:function(e){return console.warn("Wraparound mode is not supported and undocumented."),this.wraparound=e,this}},{key:"setHardcodeConstants",value:function(e){return this.hardcodeConstants=e,this}},{key:"setOutputToTexture",value:function(e){return this.outputToTexture=e,this}},{key:"setFloatTextures",value:function(e){return this.floatTextures=e,this}},{key:"setFloatOutput",value:function(e){return this.floatOutput=e,this}},{key:"setFloatOutputForce",value:function(e){return this.floatOutputForce=e,this}},{key:"setCanvas",value:function(e){return this._canvas=e,this}},{key:"setWebGl",value:function(e){return this._webGl=e,this}},{key:"setCopyData",value:function(e){return this.copyData=e,this}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getWebGl",value:function(){return this._webGl}},{key:"validateOptions",value:function(){throw new Error("validateOptions not defined")}},{key:"exec",value:function(){return this.execute.apply(this,arguments)}},{key:"execute",value:function(){var e=this,t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return a.newPromise(function(n,r){try{n(e.run.apply(e,t))}catch(t){r(t)}})}},{key:"addSubKernel",value:function(e){return null===this.subKernels&&(this.subKernels=[],this.subKernelNames=[]),this.subKernels.push(e),this.subKernelNames.push(a.getFunctionNameFromString(e)),this}},{key:"addSubKernelProperty",value:function(e,t){if(null===this.subKernelProperties&&(this.subKernelProperties={},this.subKernelNames=[]),this.subKernelProperties.hasOwnProperty(e))throw new Error("cannot add sub kernel "+e+", already defined");return this.subKernelProperties[e]=t,this.subKernelNames.push(a.getFunctionNameFromString(t)),this}},{key:"addNativeFunction",value:function(e,t){this.functionBuilder.addNativeFunction(e,t)}}]),e}()},{"../core/utils":25}],9:[function(e,t){'use strict';var n=e("../core/utils");t.exports=function(e){var t=function(){return e.run.apply(e,arguments)};return n.allPropertiesOf(e).forEach(function(n){"_"===n[0]&&"_"===n[1]||("function"==typeof e[n]?"add"===n.substring(0,3)||"set"===n.substring(0,3)?t[n]=function(){return e[n].apply(e,arguments),t}:t[n]=e[n].bind(e):(t.__defineGetter__(n,function(){return e[n]}),t.__defineSetter__(n,function(t){e[n]=t})))}),t.kernel=e,t}},{"../core/utils":25}],10:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("../core/utils"),s=e("./kernel-run-shortcut");t.exports=function(){function e(t,r){n(this,e),r=r||{},this.kernel=r.kernel,this.canvas=r.canvas,this.webGl=r.webGl,this.fn=null,this.functionBuilder=t,this.fnString=null,this.endianness=a.systemEndianness(),this.functionBuilder.polyfillStandardFunctions()}return r(e,[{key:"textureToArray",value:function(e){var t=this.createKernel(function(e){return e[this.thread.z][this.thread.y][this.thread.x]});return t(e)}},{key:"deleteTexture",value:function(e){this.webGl.deleteTexture(e.texture)}},{key:"buildPromiseKernel",value:function(){throw new Error("not yet implemented")}},{key:"getMode",value:function(){throw new Error("\"mode\" not implemented on BaseRunner")}},{key:"buildKernel",value:function(e,t){t=Object.assign({},t||{});var n=e.toString();return t.functionBuilder||(t.functionBuilder=this.functionBuilder),t.canvas||(t.canvas=this.canvas),t.webGl||(t.webGl=this.webgl),s(new this.Kernel(n,t))}}]),e}()},{"../core/utils":25,"./kernel-run-shortcut":9}],11:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return Math.floor(e+.5)}var i=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../function-builder-base"),p=e("./function-node");t.exports=function(e){function t(){n(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.Node=p,e}return a(t,e),i(t,[{key:"polyfillStandardFunctions",value:function(){this.addFunction("round",s)}}],[{key:"round",value:function(e){return s(e)}}]),t}(o)},{"../function-builder-base":6,"./function-node":12}],12:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return e.replace(d,"((").replace(h,"((")}var i=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../function-node-base"),p=e("../../core/utils"),u="Math.",l="this.",c="this.constants.",d=/decode32\(\s+encode32\(/g,h=/encode32\(\s+decode32\(/g;t.exports=function(e){function t(){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),i(t,[{key:"generate",value:function(){return(this.debug&&console.log(this),this.prototypeOnly)?t.astFunctionPrototype(this.getJsAST(),[],this).join("").trim():(this.functionStringArray=this.astGeneric(this.getJsAST(),[],this),this.functionString=s(this.functionStringArray.join("").trim()),this.functionString)}},{key:"astGeneric",value:function(e,t,n){if(null===e)throw this.astErrorOutput("NULL ast",e,n);else{if(Array.isArray(e)){for(var r=0;r<e.length;r++)this.astGeneric(e[r],t,n);return t}switch(e.type){case"FunctionDeclaration":return this.astFunctionDeclaration(e,t,n);case"FunctionExpression":return this.astFunctionExpression(e,t,n);case"ReturnStatement":return this.astReturnStatement(e,t,n);case"Literal":return this.astLiteral(e,t,n);case"BinaryExpression":return this.astBinaryExpression(e,t,n);case"Identifier":return this.astIdentifierExpression(e,t,n);case"AssignmentExpression":return this.astAssignmentExpression(e,t,n);case"ExpressionStatement":return this.astExpressionStatement(e,t,n);case"EmptyStatement":return this.astEmptyStatement(e,t,n);case"BlockStatement":return this.astBlockStatement(e,t,n);case"IfStatement":return this.astIfStatement(e,t,n);case"BreakStatement":return this.astBreakStatement(e,t,n);case"ContinueStatement":return this.astContinueStatement(e,t,n);case"ForStatement":return this.astForStatement(e,t,n);case"WhileStatement":return this.astWhileStatement(e,t,n);case"VariableDeclaration":return this.astVariableDeclaration(e,t,n);case"VariableDeclarator":return this.astVariableDeclarator(e,t,n);case"ThisExpression":return this.astThisExpression(e,t,n);case"SequenceExpression":return this.astSequenceExpression(e,t,n);case"UnaryExpression":return this.astUnaryExpression(e,t,n);case"UpdateExpression":return this.astUpdateExpression(e,t,n);case"LogicalExpression":return this.astLogicalExpression(e,t,n);case"MemberExpression":return this.astMemberExpression(e,t,n);case"CallExpression":return this.astCallExpression(e,t,n);case"ArrayExpression":return this.astArrayExpression(e,t,n);case"DebuggerStatement":return this.astDebuggerStatement(e,t,n);}throw this.astErrorOutput("Unknown ast type : "+e.type,e,n)}}},{key:"astFunctionDeclaration",value:function(e,t){return this.addFunction&&this.addFunction(null,p.getAstString(this.jsFunctionString,e)),t}},{key:"astFunctionExpression",value:function(e,t,n){if(n.isRootKernel?(t.push("void"),n.kernalAst=e):t.push(n.returnType),t.push(" "),t.push(n.functionName),t.push("("),!n.isRootKernel)for(var r,a=0;a<n.paramNames.length;++a){r=n.paramNames[a],0<a&&t.push(", ");var s=n.getParamType(r);"Texture"===s||"Input"===s||"Array"===s?t.push("sampler2D"):t.push("float"),t.push(" "),t.push("user_"),t.push(r)}t.push(") {\n");for(var o=0;o<e.body.body.length;++o)this.astGeneric(e.body.body[o],t,n),t.push("\n");return t.push("}\n"),t}},{key:"astReturnStatement",value:function(e,t,n){return n.isRootKernel?(t.push("kernelResult = "),this.astGeneric(e.argument,t,n),t.push(";"),t.push("return;")):n.isSubKernel?(t.push(n.functionName+"Result = "),this.astGeneric(e.argument,t,n),t.push(";"),t.push("return "+n.functionName+"Result;")):(t.push("return "),this.astGeneric(e.argument,t,n),t.push(";")),t}},{key:"astLiteral",value:function(e,t,n){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e,n);return t.push(e.value),Number.isInteger(e.value)&&t.push(".0"),t}},{key:"astBinaryExpression",value:function(e,t,n){return t.push("("),"%"===e.operator?(t.push("mod("),this.astGeneric(e.left,t,n),t.push(","),this.astGeneric(e.right,t,n),t.push(")")):"==="===e.operator?(this.astGeneric(e.left,t,n),t.push("=="),this.astGeneric(e.right,t,n)):"!=="===e.operator?(this.astGeneric(e.left,t,n),t.push("!="),this.astGeneric(e.right,t,n)):(this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n)),t.push(")"),t}},{key:"astIdentifierExpression",value:function(e,t,n){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e,n);switch(e.name){case"gpu_threadX":t.push("threadId.x");break;case"gpu_threadY":t.push("threadId.y");break;case"gpu_threadZ":t.push("threadId.z");break;case"gpu_outputX":t.push("uOutputDim.x");break;case"gpu_outputY":t.push("uOutputDim.y");break;case"gpu_outputZ":t.push("uOutputDim.z");break;default:if(this.constants&&this.constants.hasOwnProperty(e.name))t.push("constants_"+e.name);else{var r=n.getUserParamName(e.name);null===r?t.push("user_"+e.name):t.push("user_"+r)}}return t}},{key:"astForStatement",value:function(e,t,n){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statment",e,n);if(e.test&&"BinaryExpression"===e.test.type){if("Identifier"===e.test.right.type&&"<"===e.test.operator&&!1===this.isIdentifierConstant(e.test.right.name)){if(this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),t.push("for ("),this.astGeneric(e.init,t,n),this.astGeneric(e.test.left,t,n),t.push(e.test.operator),t.push("LOOP_MAX"),t.push(";"),this.astGeneric(e.update,t,n),t.push(")"),t.push("{\n"),t.push("if ("),this.astGeneric(e.test.left,t,n),t.push(e.test.operator),this.astGeneric(e.test.right,t,n),t.push(") {\n"),"BlockStatement"===e.body.type)for(var r=0;r<e.body.body.length;r++)this.astGeneric(e.body.body[r],t,n);else this.astGeneric(e.body,t,n);return t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}var a=JSON.parse(JSON.stringify(e.init.declarations)),s=e.update.argument;if(!Array.isArray(a)||1>a.length)throw console.log(this.jsFunctionString),new Error("Error: Incompatible for loop declaration");if(1<a.length){for(var o,p=null,u=0;u<a.length;u++)o=a[u],o.id.name===s.name?(p=o,a.splice(u,1)):(t.push("float "),this.astGeneric(o,t,n),t.push(";"));t.push("for (float "),this.astGeneric(p,t,n),t.push(";")}else t.push("for ("),this.astGeneric(e.init,t,n);return this.astGeneric(e.test,t,n),t.push(";"),this.astGeneric(e.update,t,n),t.push(")"),this.astGeneric(e.body,t,n),t}throw this.astErrorOutput("Invalid for statement",e,n)}},{key:"astWhileStatement",value:function(e,t,n){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e,n);return t.push("for (float i = 0.0; i < LOOP_MAX; i++) {"),t.push("if ("),this.astGeneric(e.test,t,n),t.push(") {\n"),this.astGeneric(e.body,t,n),t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astAssignmentExpression",value:function(e,t,n){return"%="===e.operator?void(this.astGeneric(e.left,t,n),t.push("="),t.push("mod("),this.astGeneric(e.left,t,n),t.push(","),this.astGeneric(e.right,t,n),t.push(")")):(this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t)}},{key:"astEmptyStatement",value:function(e,t){return t}},{key:"astBlockStatement",value:function(e,t,n){t.push("{\n");for(var r=0;r<e.body.length;r++)this.astGeneric(e.body[r],t,n);return t.push("}\n"),t}},{key:"astExpressionStatement",value:function(e,t,n){return this.astGeneric(e.expression,t,n),t.push(";\n"),t}},{key:"astVariableDeclaration",value:function(e,t,n){t.push("float ");for(var r=0;r<e.declarations.length;r++)0<r&&t.push(","),this.astGeneric(e.declarations[r],t,n);return t.push(";"),t}},{key:"astVariableDeclarator",value:function(e,t,n){return this.astGeneric(e.id,t,n),null!==e.init&&(t.push("="),this.astGeneric(e.init,t,n)),t}},{key:"astIfStatement",value:function(e,t,n){return t.push("if ("),this.astGeneric(e.test,t,n),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t,n):(t.push(" {\n"),this.astGeneric(e.consequent,t,n),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type?this.astGeneric(e.alternate,t,n):(t.push(" {\n"),this.astGeneric(e.alternate,t,n),t.push("\n}\n"))),t}},{key:"astBreakStatement",value:function(e,t){return t.push("break;\n"),t}},{key:"astContinueStatement",value:function(e,t){return t.push("continue;\n"),t}},{key:"astLogicalExpression",value:function(e,t,n){return t.push("("),this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t.push(")"),t}},{key:"astUpdateExpression",value:function(e,t,n){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t,n)):(this.astGeneric(e.argument,t,n),t.push(e.operator)),t}},{key:"astUnaryExpression",value:function(e,t,n){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t,n)):(this.astGeneric(e.argument,t,n),t.push(e.operator)),t}},{key:"astThisExpression",value:function(e,t){return t.push("this"),t}},{key:"astMemberExpression",value:function(e,t,n){if(!e.computed){var r=this.astMemberExpressionUnroll(e),a=r.toLowerCase();0===r.indexOf(c)&&(r="constants_"+r.slice(c.length)),"this.thread.x"===a?t.push("threadId.x"):"this.thread.y"===a?t.push("threadId.y"):"this.thread.z"===a?t.push("threadId.z"):"this.output.x"===a?t.push(this.output[0]+".0"):"this.output.y"===a?t.push(this.output[1]+".0"):"this.output.z"===a?t.push(this.output[2]+".0"):t.push(r)}else if("Identifier"===e.object.type){var s=e.object.name,i=n.functionName||"kernel",o=!1;if(n.paramNames){var p=n.paramNames.indexOf(s);0<=p&&"float"===n.paramTypes[p]&&(o=!0)}o?(this.astGeneric(e.object,t,n),t.push("[int("),this.astGeneric(e.property,t,n),t.push(")]")):(t.push("get("),this.astGeneric(e.object,t,n),t.push(", vec2("),this.astGeneric(e.object,t,n),t.push("Size[0],"),this.astGeneric(e.object,t,n),t.push("Size[1]), vec3("),this.astGeneric(e.object,t,n),t.push("Dim[0],"),this.astGeneric(e.object,t,n),t.push("Dim[1],"),this.astGeneric(e.object,t,n),t.push("Dim[2]"),t.push("), "),this.astGeneric(e.property,t,n),t.push(")"))}else{this.astGeneric(e.object,t,n);var u=t.pop();t.push(","),this.astGeneric(e.property,t,n),t.push(u)}return t}},{key:"astSequenceExpression",value:function(e,t,n){for(var r=0;r<e.expressions.length;r++)0<r&&t.push(","),this.astGeneric(e.expressions,t,n);return t}},{key:"astCallExpression",value:function(e,t,n){if(e.callee){var r=this.astMemberExpressionUnroll(e.callee);0===r.indexOf(u)&&(r=r.slice(u.length)),0===r.indexOf(l)&&(r=r.slice(l.length)),0>n.calledFunctions.indexOf(r)&&n.calledFunctions.push(r),n.hasOwnProperty("funcName")||(n.calledFunctionsArguments[r]=[]);var a=[];n.calledFunctionsArguments[r].push(a),t.push(r),t.push("(");for(var s,o=0;o<e.arguments.length;++o)if(s=e.arguments[o],0<o&&t.push(", "),this.astGeneric(s,t,n),"Identifier"===s.type){var p=n.paramNames.indexOf(s.name);-1===p?a.push(null):a.push({name:s.name,type:n.paramTypes[p]})}else a.push(null);return t.push(")"),t}throw this.astErrorOutput("Unknown CallExpression",e,n)}},{key:"astArrayExpression",value:function(e,t,n){var r=e.elements.length;t.push("float["+r+"](");for(var a=0;a<r;++a){0<a&&t.push(", ");var s=e.elements[a];this.astGeneric(s,t,n)}return t.push(")"),t}},{key:"getFunctionPrototypeString",value:function(){return this.webGlFunctionPrototypeString?this.webGlFunctionPrototypeString:this.webGlFunctionPrototypeString=this.generate()}},{key:"build",value:function(){return 0<this.getFunctionPrototypeString().length}}],[{key:"astFunctionPrototype",value:function(e,t,n){if(n.isRootKernel||n.isSubKernel)return t;t.push(n.returnType),t.push(" "),t.push(n.functionName),t.push("(");for(var r=0;r<n.paramNames.length;++r)0<r&&t.push(", "),t.push(n.paramTypes[r]),t.push(" "),t.push("user_"),t.push(n.paramNames[r]);return t.push(");\n"),t}}]),t}(o)},{"../../core/utils":25,"../function-node-base":7}],13:[function(e,t){'use strict';var n=e("../../core/utils"),r=e("../kernel-run-shortcut");t.exports=function(e,t){return"() => {\n    "+r.toString()+";\n    const utils = {\n      allPropertiesOf: function "+n.allPropertiesOf.toString()+",\n      clone: function "+n.clone.toString()+",\n      splitArray: function "+n.splitArray.toString()+",\n      getArgumentType: function "+n.getArgumentType.toString()+",\n      getDimensions: function "+n.getDimensions.toString()+",\n      dimToTexSize: function "+n.dimToTexSize.toString()+",\n      copyFlatten: function "+n.copyFlatten.toString()+",\n      flatten: function "+n.flatten.toString()+",\n      systemEndianness: '"+n.systemEndianness()+"',\n      initWebGl: function "+n.initWebGl.toString()+",\n      isArray: function "+n.isArray.toString()+"\n    };\n    class "+(t||"Kernel")+" {\n      constructor() {\n        this.argumentsLength = 0;\n        this._canvas = null;\n        this._webGl = null;\n        this.built = false;\n        this.program = null;\n        this.paramNames = "+JSON.stringify(e.paramNames)+";\n        this.paramTypes = "+JSON.stringify(e.paramTypes)+";\n        this.texSize = "+JSON.stringify(e.texSize)+";\n        this.output = "+JSON.stringify(e.output)+";\n        this.compiledFragShaderString = `"+e.compiledFragShaderString+"`;\n\t\t    this.compiledVertShaderString = `"+e.compiledVertShaderString+"`;\n\t\t    this.programUniformLocationCache = {};\n\t\t    this.textureCache = {};\n\t\t    this.subKernelOutputTextures = null;\n      }\n      "+e._getFragShaderString.toString()+"\n      "+e._getVertShaderString.toString()+"\n      validateOptions() {}\n      setupParams() {}\n      setCanvas(canvas) { this._canvas = canvas; return this; }\n      setWebGl(webGl) { this._webGl = webGl; return this; }\n      "+e.getUniformLocation.toString()+"\n      "+e.setupParams.toString()+"\n      "+e.build.toString()+"\n\t\t  "+e.run.toString()+"\n\t\t  "+e._addArgument.toString()+"\n\t\t  "+e.getArgumentTexture.toString()+"\n\t\t  "+e.getTextureCache.toString()+"\n\t\t  "+e.getOutputTexture.toString()+"\n\t\t  "+e.renderOutput.toString()+"\n    };\n    return kernelRunShortcut(new Kernel());\n  };"}},{"../../core/utils":25,"../kernel-run-shortcut":9}],14:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../kernel-base"),o=e("../../core/utils"),u=e("../../core/texture"),l=e("./shader-frag"),c=e("./shader-vert"),d=e("./kernel-string"),h=[],m={};t.exports=function(e){function t(e,a){n(this,t);var s=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,a));return s.textureCache={},s.threadDim={},s.programUniformLocationCache={},s.framebuffer=null,s.buffer=null,s.program=null,s.outputToTexture=a.outputToTexture,s.endianness=o.systemEndianness(),s.subKernelOutputTextures=null,s.subKernelOutputVariableNames=null,s.argumentsLength=0,s.ext=null,s.compiledFragShaderString=null,s.compiledVertShaderString=null,s.extDrawBuffersMap=null,s.outputTexture=null,s.maxTexSize=null,s._webGl||(s._webGl=o.initWebGl(s.getCanvas())),s}return a(t,e),s(t,[{key:"validateOptions",value:function(){var e=o.isFloatReadPixelsSupported();if(!0===this.floatTextures&&!o.OES_texture_float)throw new Error("Float textures are not supported on this browser");else if(!0===this.floatOutput&&!0!==this.floatOutputForce&&!e)throw new Error("Float texture outputs are not supported on this browser");else void 0===this.floatTextures&&o.OES_texture_float&&(this.floatTextures=!0,this.floatOutput=e);if(!this.output||0===this.output.length){if(1!==arguments.length)throw new Error("Auto output only supported for kernels with only one input");var t=o.getArgumentType(arguments[0]);if("Array"===t)this.output=o.getDimensions(t);else if("Texture"===t)this.output=arguments[0].output;else throw new Error("Auto output not supported for input type: "+t)}if(this.texSize=o.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0),this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.floatOutput&&(this.floatOutput=!1,console.warn("Cannot use graphical mode and float output at the same time")),this.texSize=o.clone(this.output)}else void 0===this.floatOutput&&o.OES_texture_float&&(this.floatOutput=!0)}},{key:"updateMaxTexSize",value:function(){var e=this.texSize,t=this._canvas;if(null===this.maxTexSize){var n=h.indexOf(t);-1===n&&(n=h.length,h.push(t),m[n]=[e[0],e[1]]),this.maxTexSize=m[n]}this.maxTexSize[0]<e[0]&&(this.maxTexSize[0]=e[0]),this.maxTexSize[1]<e[1]&&(this.maxTexSize[1]=e[1])}},{key:"build",value:function(){this.validateOptions(),this.setupParams(arguments),this.updateMaxTexSize();var e=this.texSize,t=this._webGl,n=this._canvas;t.enable(t.SCISSOR_TEST),t.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),n.width=this.maxTexSize[0],n.height=this.maxTexSize[1];for(var r=this.threadDim=o.clone(this.output);3>r.length;)r.push(1);this.functionBuilder&&this._addKernels();var a=this._getVertShaderString(arguments),s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,a),t.compileShader(s);var p=this._getFragShaderString(arguments),u=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(u,p),t.compileShader(u),!t.getShaderParameter(s,t.COMPILE_STATUS))throw console.log(a),console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(s)),new Error("Error compiling vertex shader");if(!t.getShaderParameter(u,t.COMPILE_STATUS))throw console.log(p),console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(u)),new Error("Error compiling fragment shader");this.debug&&(console.log("Options:"),console.dir(this),console.log("GLSL Shader Output:"),console.log(p));var l=this.program=t.createProgram();t.attachShader(l,s),t.attachShader(l,u),t.linkProgram(l),this.framebuffer=t.createFramebuffer(),this.framebuffer.width=e[0],this.framebuffer.height=e[1];var c=new Float32Array([-1,-1,1,-1,-1,1,1,1]),d=new Float32Array([0,0,1,0,0,1,1,1]),h=c.byteLength,m=this.buffer;m?t.bindBuffer(t.ARRAY_BUFFER,m):(m=this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,m),t.bufferData(t.ARRAY_BUFFER,c.byteLength+d.byteLength,t.STATIC_DRAW)),t.bufferSubData(t.ARRAY_BUFFER,0,c),t.bufferSubData(t.ARRAY_BUFFER,h,d);var f=t.getAttribLocation(this.program,"aPos");t.enableVertexAttribArray(f),t.vertexAttribPointer(f,2,t.FLOAT,t.FALSE,0,0);var g=t.getAttribLocation(this.program,"aTexCoord");if(t.enableVertexAttribArray(g),t.vertexAttribPointer(g,2,t.FLOAT,t.FALSE,0,h),this.setupOutputTexture(),null!==this.subKernelOutputTextures)for(var y,x=this.extDrawBuffersMap=[t.COLOR_ATTACHMENT0],b=0;b<this.subKernelOutputTextures.length;b++)y=this.subKernelOutputTextures[b],x.push(t.COLOR_ATTACHMENT0+b+1),t.activeTexture(t.TEXTURE0+arguments.length+b),t.bindTexture(t.TEXTURE_2D,y),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.floatOutput?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,null)}},{key:"run",value:function(){null===this.program&&this.build.apply(this,arguments);var e=this.paramNames,t=this.paramTypes,n=this.texSize,r=this._webGl;if(r.useProgram(this.program),r.scissor(0,0,n[0],n[1]),!this.hardcodeConstants){var a=this.getUniformLocation("uOutputDim");r.uniform3fv(a,this.threadDim);var s=this.getUniformLocation("uTexSize");r.uniform2fv(s,n)}var o=this.getUniformLocation("ratio");r.uniform2f(o,n[0]/this.maxTexSize[0],n[1]/this.maxTexSize[1]),this.argumentsLength=0;for(var l=0;l<e.length;l++)this._addArgument(arguments[l],t[l],e[l]);if(this.graphical)return r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),void r.drawArrays(r.TRIANGLE_STRIP,0,4);r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer);var c=this.outputTexture;if(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,c,0),null!==this.subKernelOutputTextures){for(var d,h=0;h<this.subKernelOutputTextures.length;h++)d=this.subKernelOutputTextures[h],r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+h+1,r.TEXTURE_2D,d,0);this.ext.drawBuffersWEBGL(this.extDrawBuffersMap)}if(r.drawArrays(r.TRIANGLE_STRIP,0,4),null!==this.subKernelOutputTextures){if(null!==this.subKernels){var m=[];m.result=this.renderOutput(c);for(var f=0;f<this.subKernels.length;f++)m.push(new u(this.subKernelOutputTextures[f],n,this.output,this._webGl));return m}if(null!==this.subKernelProperties){var g={result:this.renderOutput(c)},y=0;for(var x in this.subKernelProperties)this.subKernelProperties.hasOwnProperty(x)&&(g[x]=new u(this.subKernelOutputTextures[y],n,this.output,this._webGl),y++);return g}}return this.renderOutput(c)}},{key:"renderOutput",value:function(e){var t=this.texSize,n=this._webGl,r=this.threadDim,a=this.output;if(this.outputToTexture)return new u(e,t,a,this._webGl);var s;if(this.floatOutput)s=new Float32Array(4*(t[0]*t[1])),n.readPixels(0,0,t[0],t[1],n.RGBA,n.FLOAT,s);else{var i=new Uint8Array(4*(t[0]*t[1]));n.readPixels(0,0,t[0],t[1],n.RGBA,n.UNSIGNED_BYTE,i),s=new Float32Array(i.buffer)}if(s=s.subarray(0,r[0]*r[1]*r[2]),1===a.length)return s;if(2===a.length)return o.splitArray(s,a[0]);if(3===a.length){var p=o.splitArray(s,a[0]*a[1]);return p.map(function(e){return o.splitArray(e,a[0])})}}},{key:"getOutputTexture",value:function(){return this.getTextureCache("OUTPUT")}},{key:"detachOutputTexture",value:function(){this.detachTextureCache("OUTPUT")}},{key:"setupOutputTexture",value:function(){var e=this._webGl,t=this.texSize;this.detachOutputTexture(),this.outputTexture=this.getOutputTexture(),e.activeTexture(e.TEXTURE0+this.paramNames.length),e.bindTexture(e.TEXTURE_2D,this.outputTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.floatOutput?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.UNSIGNED_BYTE,null)}},{key:"getArgumentTexture",value:function(e){return this.getTextureCache("ARGUMENT_"+e)}},{key:"getSubKernelTexture",value:function(e){return this.getTextureCache("SUB_KERNEL_"+e)}},{key:"getTextureCache",value:function(e){return this.outputToTexture?this._webGl.createTexture():this.textureCache.hasOwnProperty(e)?this.textureCache[e]:this.textureCache[e]=this._webGl.createTexture()}},{key:"detachTextureCache",value:function(e){delete this.textureCache[e]}},{key:"getUniformLocation",value:function(e){var t=this.programUniformLocationCache[e];return t||(t=this._webGl.getUniformLocation(this.program,e),this.programUniformLocationCache[e]=t),t}},{key:"_getFragShaderArtifactMap",value:function(e){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),GET_WRAPAROUND:this._getGetWraparoundString(),GET_TEXTURE_CHANNEL:this._getGetTextureChannelString(),GET_TEXTURE_INDEX:this._getGetTextureIndexString(),GET_RESULT:this._getGetResultString(),MAIN_PARAMS:this._getMainParamsString(e),MAIN_CONSTANTS:this._getMainConstantsString(),KERNEL:this._getKernelString(),MAIN_RESULT:this._getMainResultString()}}},{key:"_addArgument",value:function(e,t,n){var r=this._webGl,a=this.getArgumentTexture(n);switch(e instanceof u&&(t="Texture"),t){case"Array":{var s=o.getDimensions(e,!0),i=o.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},s);r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);var p=i[0]*i[1];this.floatTextures&&(p*=4);var l=new Float32Array(p);o.flattenTo(e,l);var c;this.floatTextures?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i[0],i[1],0,r.RGBA,r.FLOAT,l):(c=new Uint8Array(l.buffer),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i[0],i[1],0,r.RGBA,r.UNSIGNED_BYTE,c));var d=this.getUniformLocation("user_"+n),h=this.getUniformLocation("user_"+n+"Size"),m=this.getUniformLocation("user_"+n+"Dim");this.hardcodeConstants||(r.uniform3fv(m,s),r.uniform2fv(h,i)),r.uniform1i(d,this.argumentsLength);break}case"Number":{var f=this.getUniformLocation("user_"+n);r.uniform1f(f,e);break}case"Input":{var g=e,y=g.size,x=o.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},y);r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);var b=x[0]*x[1],_=void 0;if(this.floatTextures?(b*=4,_=new Float32Array(b),_.set(g.value)):_=g.value,this.floatTextures)r.texImage2D(r.TEXTURE_2D,0,r.RGBA,x[0],x[1],0,r.RGBA,r.FLOAT,_);else{var S=new Uint8Array(_.buffer);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,x[0],x[1],0,r.RGBA,r.UNSIGNED_BYTE,S)}var k=this.getUniformLocation("user_"+n),E=this.getUniformLocation("user_"+n+"Size"),v=this.getUniformLocation("user_"+n+"Dim");this.hardcodeConstants||(r.uniform3fv(v,y),r.uniform2fv(E,x)),r.uniform1i(k,this.argumentsLength);break}case"Texture":{var T=e,A=o.getDimensions(T,!0),O=T.size;T.texture===this.outputTexture&&this.setupOutputTexture(),r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,T.texture);var P=this.getUniformLocation("user_"+n),N=this.getUniformLocation("user_"+n+"Size"),C=this.getUniformLocation("user_"+n+"Dim");r.uniform3fv(C,A),r.uniform2fv(N,O),r.uniform1i(P,this.argumentsLength);break}default:throw new Error("Input type not supported (WebGL): "+e);}this.argumentsLength++}},{key:"_getHeaderString",value:function(){return null!==this.subKernels||null!==this.subKernelProperties?"#extension GL_EXT_draw_buffers : require\n":""}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+".0;\n":" 1000.0;\n"}},{key:"_getConstantsString",value:function(){var e=[],t=this.threadDim,n=this.texSize;return this.hardcodeConstants?e.push("highp vec3 uOutputDim = vec3("+t[0]+","+t[1]+", "+t[2]+")","highp vec2 uTexSize = vec2("+n[0]+", "+n[1]+")"):e.push("uniform highp vec3 uOutputDim","uniform highp vec2 uTexSize"),this._linesToString(e)}},{key:"_getTextureCoordinate",value:function(){var e=this.subKernelOutputVariableNames;return null===e||1>e.length?"varying highp vec2 vTexCoord;\n":"out highp vec2 vTexCoord;\n"}},{key:"_getDecode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getEncode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getGetWraparoundString",value:function(){return this.wraparound?"  xyz = mod(xyz, texDim);\n":""}},{key:"_getGetTextureChannelString",value:function(){return this.floatTextures?this._linesToString(["  int channel = int(integerMod(index, 4.0))","  index = float(int(index) / 4)"]):""}},{key:"_getGetTextureIndexString",value:function(){return this.floatTextures?"  index = float(int(index)/4);\n":""}},{key:"_getGetResultString",value:function(){return this.floatTextures?this._linesToString(["  if (channel == 0) return texel.r","  if (channel == 1) return texel.g","  if (channel == 2) return texel.b","  if (channel == 3) return texel.a"]):"  return decode32(texel);\n"}},{key:"_getMainParamsString",value:function(e){for(var t=[],n=this.paramTypes,r=this.paramNames,a=0;a<r.length;a++){var s=e[a],p=r[a],u=n[a];if(!this.hardcodeConstants)"Array"===u||"Texture"===u||"Input"===u?t.push("uniform highp sampler2D user_"+p,"uniform highp vec2 user_"+p+"Size","uniform highp vec3 user_"+p+"Dim"):"Number"===u&&t.push("uniform highp float user_"+p);else if("Array"===u||"Texture"===u){var l=o.getDimensions(s,!0),c=o.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},l);t.push("uniform highp sampler2D user_"+p,"highp vec2 user_"+p+"Size = vec2("+c[0]+".0, "+c[1]+".0)","highp vec3 user_"+p+"Dim = vec3("+l[0]+".0, "+l[1]+".0, "+l[2]+".0)")}else"Number"===u&&Number.isInteger(s)?t.push("highp float user_"+p+" = "+s+".0"):"Number"===u&&t.push("highp float user_"+p+" = "+s)}return this._linesToString(t)}},{key:"_getMainConstantsString",value:function(){var e=[];if(this.constants)for(var t in this.constants)if(this.constants.hasOwnProperty(t)){var n=parseFloat(this.constants[t]);Number.isInteger(n)?e.push("const float constants_"+t+" = "+parseInt(n)+".0"):e.push("const float constants_"+t+" = "+parseFloat(n))}return this._linesToString(e)}},{key:"_getKernelString",value:function(){var e=[],t=this.subKernelOutputVariableNames;if(null!==t){e.push("highp float kernelResult = 0.0");for(var n=0;n<t.length;n++)e.push("highp float "+t[n]+" = 0.0")}else e.push("highp float kernelResult = 0.0");return this._linesToString(e)+this.functionBuilder.getPrototypeString("kernel")}},{key:"_getMainResultString",value:function(){var e=this.subKernelOutputVariableNames,t=[];if(this.floatOutput&&t.push("  index *= 4.0"),this.graphical)t.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor");else if(this.floatOutput)for(var n=["r","g","b","a"],r=0;r<n.length;++r){if(t.push("  threadId = indexTo3D(index, uOutputDim)"),t.push("  kernel()"),e){t.push("  gl_FragData[0]."+n[r]+" = kernelResult");for(var a=0;a<e.length;++a)t.push("  gl_FragData["+(a+1)+"]."+n[r]+" = "+e[a])}else t.push("  gl_FragColor."+n[r]+" = kernelResult");r<n.length-1&&t.push("  index += 1.0")}else if(null!==e){t.push("  threadId = indexTo3D(index, uOutputDim)"),t.push("  kernel()"),t.push("  gl_FragData[0] = encode32(kernelResult)");for(var s=0;s<e.length;s++)t.push("  gl_FragData["+(s+1)+"] = encode32("+e[s]+")")}else t.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = encode32(kernelResult)");return this._linesToString(t)}},{key:"_linesToString",value:function(e){return 0<e.length?e.join(";\n")+";\n":"\n"}},{key:"_replaceArtifacts",value:function(e,t){return e.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z])*)__;\n/g,function(e,n){if(t.hasOwnProperty(n))return t[n];throw"unhandled artifact "+n})}},{key:"_addKernels",value:function(){var e=this.functionBuilder,t=this._webGl;if(e.addFunctions(this.functions,{constants:this.constants,output:this.output}),e.addNativeFunctions(this.nativeFunctions),e.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations},this.paramNames,this.paramTypes),null!==this.subKernels){var n=this.ext=t.getExtension("WEBGL_draw_buffers");if(!n)throw new Error("could not instantiate draw buffers extension");this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[];for(var r,a=0;a<this.subKernels.length;a++)r=this.subKernels[a],e.addSubKernel(r,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations}),this.subKernelOutputTextures.push(this.getSubKernelTexture(a)),this.subKernelOutputVariableNames.push(r.name+"Result")}else if(null!==this.subKernelProperties){var s=this.ext=t.getExtension("WEBGL_draw_buffers");if(!s)throw new Error("could not instantiate draw buffers extension");this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[];var o=0;for(var u in this.subKernelProperties)if(this.subKernelProperties.hasOwnProperty(u)){var p=this.subKernelProperties[u];e.addSubKernel(p,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations}),this.subKernelOutputTextures.push(this.getSubKernelTexture(u)),this.subKernelOutputVariableNames.push(p.name+"Result"),o++}}}},{key:"_getFragShaderString",value:function(e){return null===this.compiledFragShaderString?this.compiledFragShaderString=this._replaceArtifacts(l,this._getFragShaderArtifactMap(e)):this.compiledFragShaderString}},{key:"_getVertShaderString",value:function(){return null===this.compiledVertShaderString?this.compiledVertShaderString=c:this.compiledVertShaderString}},{key:"toString",value:function(){return d(this)}},{key:"addFunction",value:function(e){this.functionBuilder.addFunction(null,e)}}]),t}(i)},{"../../core/texture":23,"../../core/utils":25,"../kernel-base":8,"./kernel-string":13,"./shader-frag":16,"./shader-vert":17}],15:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("../runner-base"),o=e("./kernel"),p=e("../../core/utils"),u=e("./function-builder");t.exports=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,new u,e));return a.Kernel=o,a.kernel=null,a}return a(t,e),s(t,[{key:"getMode",value:function(){return"gpu"}}]),t}(i)},{"../../core/utils":25,"../runner-base":10,"./function-builder":11,"./kernel":14}],16:[function(e,t){"use strict";t.exports="__HEADER__;\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nconst float LOOP_MAX = __LOOP_MAX__;\n#define EPSILON 0.0000001;\n\n__CONSTANTS__;\n\nvarying highp vec2 vTexCoord;\n\nvec4 round(vec4 x) {\n  return floor(x + 0.5);\n}\n\nhighp float round(highp float x) {\n  return floor(x + 0.5);\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nhighp float integerMod(highp float x, highp float y) {\n  highp float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nhighp int integerMod(highp int x, highp int y) {\n  return int(integerMod(float(x), float(y)));\n}\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nhighp float decode32(highp vec4 rgba) {\n  __DECODE32_ENDIANNESS__;\n  rgba *= 255.0;\n  vec2 gte128;\n  gte128.x = rgba.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = rgba.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * rgba.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  rgba.b = rgba.b - 128.0 * gte128.x;\n  res = dot(rgba, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nhighp vec4 encode32(highp float f) {\n  highp float F = abs(f);\n  highp float sign = f < 0.0 ? 1.0 : 0.0;\n  highp float exponent = floor(log2(F));\n  highp float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 rgba = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  rgba.rg = integerMod(rgba.rg, 256.0);\n  rgba.b = integerMod(rgba.b, 128.0);\n  rgba.a = exponent*0.5 + 63.5;\n  rgba.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  rgba = floor(rgba);\n  rgba *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return rgba;\n}\n// Dragons end here\n\nhighp float index;\nhighp vec3 threadId;\n\nhighp vec3 indexTo3D(highp float idx, highp vec3 texDim) {\n  highp float z = floor(idx / (texDim.x * texDim.y));\n  idx -= z * texDim.x * texDim.y;\n  highp float y = floor(idx / texDim.x);\n  highp float x = integerMod(idx, texDim.x);\n  return vec3(x, y, z);\n}\n\nhighp float get(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float z, highp float y, highp float x) {\n  highp vec3 xyz = vec3(x, y, z);\n  xyz = floor(xyz + 0.5);\n  __GET_WRAPAROUND__;\n  highp float index = round(xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z));\n  __GET_TEXTURE_CHANNEL__;\n  highp float w = round(texSize.x);\n  vec2 st = vec2(integerMod(index, w), float(int(index) / int(w))) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  highp vec4 texel = texture2D(tex, st / texSize);\n  __GET_RESULT__;\n}\n\nhighp float get(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float y, highp float x) {\n  return get(tex, texSize, texDim, 0.0, y, x);\n}\n\nhighp float get(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float x) {\n  return get(tex, texSize, texDim, 0.0, 0.0, x);\n}\n\nhighp vec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\n__MAIN_PARAMS__;\n__MAIN_CONSTANTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = floor(vTexCoord.s * float(uTexSize.x)) + floor(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}"},{}],17:[function(e,t){"use strict";t.exports="precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nattribute highp vec2 aPos;\nattribute highp vec2 aTexCoord;\n\nvarying highp vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"},{}],18:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=e("./kernel"),o=e("../../core/utils");t.exports=function(e){function t(){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"validateOptions",value:function(){this.texSize=o.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0)}}]),t}(i)},{"../../core/utils":25,"./kernel":14}],19:[function(e,t){'use strict';var n=e("./utils");t.exports=function(e,t){var r=t.toString();return new Function("return function "+e+" ("+n.getParamNamesFromString(r).join(", ")+") {"+n.getFunctionBodyFromString(r)+"}")()}},{"./utils":25}],20:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./utils-core");t.exports=function(){function e(){n(this,e)}return r(e,null,[{key:"validateKernelObj",value:function(e){if(null===e)throw"KernelObj being validated is NULL";if("string"==typeof e){try{e=JSON.parse(e)}catch(t){throw console.error(t),"Failed to convert KernelObj from JSON string"}if(null===e)throw"Invalid (NULL) KernelObj JSON string representation"}if(!0!==e.isKernelObj)throw"Failed missing isKernelObj flag check";return e}},{key:"loadKernelObj",value:function(e){e=validateKernelObj(e)}}]),e}()},{"./utils-core":24}],21:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./utils"),p=e("../backend/web-gl/runner"),u=e("../backend/cpu/runner"),l=e("../backend/web-gl/validator-kernel"),c=e("./gpu-core"),d=function(e){function t(e){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));e=e||{},a._canvas=e.canvas||null,a._webGl=e.webGl||null;var s=e.mode,i=void 0;if(!!o.isWebGlSupported())i=s||"gpu";else if(s&&"cpu"!==s)throw new Error("A requested mode of \""+s+"\" and is not supported");else console.warn("Warning: gpu not supported, falling back to cpu support"),i="cpu";a.kernels=[];var c={canvas:a._canvas,webGl:a._webGl};switch(i){case"cpu":a._runner=new u(c);break;case"webgl":case"gpu":a._runner=new p(c);break;case"webgl-validator":a._runner=new p(c),a._runner.Kernel=l;break;default:throw new Error("\""+s+"\" mode is not defined");}return a}return a(t,e),s(t,[{key:"createKernel",value:function(e,t){if("undefined"==typeof e)throw"Missing fn parameter";if(!o.isFunction(e)&&"string"!=typeof e)throw"fn parameter not a function";var n=this._runner.buildKernel(e,t||{});return this._canvas||(this._canvas=n.getCanvas()),this._runner.canvas||(this._runner.canvas=n.getCanvas()),this.kernels.push(n),n}},{key:"createKernelMap",value:function(){var e=void 0,t=void 0;"function"==typeof arguments[arguments.length-2]?(e=arguments[arguments.length-2],t=arguments[arguments.length-1]):e=arguments[arguments.length-1],o.isWebGlDrawBuffersSupported()||(this._runner=new u(t));var n=this.createKernel(e,t);if(Array.isArray(arguments[0]))for(var r=arguments[0],a=0;a<r.length;a++)n.addSubKernel(r[a]);else{var s=arguments[0];for(var l in s)s.hasOwnProperty(l)&&n.addSubKernelProperty(l,s[l])}return n}},{key:"combineKernels",value:function(){var e=arguments[arguments.length-2],t=arguments[arguments.length-1];if("cpu"===this.getMode())return t;for(var n=arguments[0].getCanvas(),r=arguments[0].getWebGl(),a=0;a<arguments.length-1;a++)arguments[a].setCanvas(n).setWebGl(r).setOutputToTexture(!0);return function(){t.apply(null,arguments);var n=e.texSize,r=e.getWebGl(),a=e.threadDim,s=void 0;if(e.floatOutput)s=new Float32Array(4*(n[0]*n[1])),r.readPixels(0,0,n[0],n[1],r.RGBA,r.FLOAT,s);else{var i=new Uint8Array(4*(n[0]*n[1]));r.readPixels(0,0,n[0],n[1],r.RGBA,r.UNSIGNED_BYTE,i),s=new Float32Array(i.buffer)}if(s=s.subarray(0,a[0]*a[1]*a[2]),1===e.output.length)return s;if(2===e.output.length)return o.splitArray(s,e.output[0]);if(3===e.output.length){var p=o.splitArray(s,e.output[0]*e.output[1]);return p.map(function(t){return o.splitArray(t,e.output[0])})}}}},{key:"addFunction",value:function(e,t,n){return this._runner.functionBuilder.addFunction(null,e,t,n),this}},{key:"addNativeFunction",value:function(e,t){return this._runner.functionBuilder.addNativeFunction(e,t),this}},{key:"getMode",value:function(){return this._runner.getMode()}},{key:"isWebGlSupported",value:function(){return o.isWebGlSupported()}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getWebGl",value:function(){return this._webGl}}]),t}(c);Object.assign(d,c),t.exports=d},{"../backend/cpu/runner":5,"../backend/web-gl/runner":15,"../backend/web-gl/validator-kernel":18,"./gpu-core":20,"./utils":25}],22:[function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.exports=function e(t,r){if(n(this,e),this.value=t,Array.isArray(r)){this.size=[];for(var a=0;a<r.length;a++)this.size[a]=r[a];for(;3>this.size.length;)this.size.push(1)}else this.size=r.z?[r.x,r.y,r.z]:r.y?[r.x,r.y,1]:[r.x,1,1]}},{}],23:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=function(){function e(t,r,a,s){n(this,e),this.texture=t,this.size=r,this.output=a,this.webGl=s,this.kernel=null}return r(e,[{key:"toArray",value:function(e){if(!e)throw new Error("You need to pass the GPU object for toArray to work.");return this.kernel?this.kernel(this):(this.kernel=e.createKernel(function(e){return e[this.thread.z][this.thread.y][this.thread.x]}).setOutput(this.output),this.kernel(this))}},{key:"delete",value:function(){return this.webGl.deleteTexture(this.texture)}}]),e}()},{}],24:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){n(this,e)}return r(e,null,[{key:"isCanvas",value:function(e){return null!==e&&e.nodeName&&e.getContext&&"CANVAS"===e.nodeName.toUpperCase()}},{key:"isCanvasSupported",value:function(){return s}},{key:"initCanvas",value:function(){if(!s)return null;var e=document.createElement("canvas");return e.width=2,e.height=2,e}},{key:"isWebGl",value:function(e){return e&&"function"==typeof e.getExtension}},{key:"isWebGlSupported",value:function(){return o}},{key:"isWebGlDrawBuffersSupported",value:function(){return p}},{key:"initWebGlDefaultOptions",value:function(){return{alpha:!1,depth:!1,antialias:!1}}},{key:"initWebGl",value:function(t){if(("undefined"!=typeof s||null===t)&&!s)return null;if(!e.isCanvas(t))throw new Error("Invalid canvas object - "+t);var n=t.getContext("experimental-webgl",e.initWebGlDefaultOptions())||t.getContext("webgl",e.initWebGlDefaultOptions());return n&&(n.OES_texture_float=n.getExtension("OES_texture_float"),n.OES_texture_float_linear=n.getExtension("OES_texture_float_linear"),n.OES_element_index_uint=n.getExtension("OES_element_index_uint")),n}}]),e}(),s="undefined"!=typeof document&&a.isCanvas(document.createElement("canvas")),i=a.initWebGl(a.initCanvas()),o=a.isWebGl(i),p=o&&!!i.getExtension("WEBGL_draw_buffers");o?(a.OES_texture_float=i.OES_texture_float,a.OES_texture_float_linear=i.OES_texture_float_linear,a.OES_element_index_uint=i.OES_element_index_uint):(a.OES_texture_float=!1,a.OES_texture_float_linear=!1,a.OES_element_index_uint=!1),t.exports=a},{}],25:[function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n,r=0;r<t.length;r++)n=t[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./utils-core"),p=e("./input"),u=e("./texture"),l=/function ([^(]*)/,c=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,d=/([^\s,]+)/g,h=function(){var e=new ArrayBuffer(4),t=new Uint32Array(e),n=new Uint8Array(e);if(t[0]=3735928559,239===n[0])return"LE";if(222===n[0])return"BE";throw new Error("unknown endianness")}(),m=null,f=function(){try{return new Function("let i = 1; const j = 1;")(),!0}catch(t){return!1}}(),g=function(t){function o(){return n(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return a(o,t),i(o,null,[{key:"systemEndianness",value:function(){return h}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"isFunctionString",value:function(e){return null!==e&&"function"===e.toString().slice(0,8).toLowerCase()}},{key:"getFunctionNameFromString",value:function(e){return l.exec(e)[1]}},{key:"getFunctionBodyFromString",value:function(e){return e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))}},{key:"getParamNamesFromString",value:function(e){var t=e.toString().replace(c,""),n=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(d);return null===n&&(n=[]),n}},{key:"clone",value:function(e){if(null===e||"object"!==("undefined"==typeof e?"undefined":s(e))||e.hasOwnProperty("isActiveClone"))return e;var t=e.constructor();for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e.isActiveClone=null,t[n]=o.clone(e[n]),delete e.isActiveClone);return t}},{key:"newPromise",value:function(e){var t=Promise||small_promise;if(null===t)throw TypeError("Browser is missing Promise implementation. Consider adding small_promise.js polyfill");return new t(e)}},{key:"functionBinder",value:function(e,t){return e.bind?e.bind(t):function(){var n=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return e.apply(t,n)}}},{key:"isArray",value:function(e){return!isNaN(e.length)}},{key:"getArgumentType",value:function(e){return o.isArray(e)?"Array":"number"==typeof e?"Number":e instanceof u?"Texture":e instanceof p?"Input":"Unknown"}},{key:"isFloatReadPixelsSupported",value:function(){if(null!==m)return m;var t=e("../index"),n=new t({mode:"webgl-validator"}).createKernel(function(){return 1},{output:[2],floatTextures:!0,floatOutput:!0,floatOutputForce:!0})();return m=1===n[0],m}},{key:"isMixedIdentifiersSupported",value:function(){return f}},{key:"dimToTexSize",value:function(e,t,n){for(var r=t[0],a=1;a<t.length;a++)r*=t[a];e.floatTextures&&(!n||e.floatOutput)&&(r=Math.ceil(r/4));var s=Math.ceil(Math.sqrt(r));return[s,s]}},{key:"getDimensions",value:function(e,t){var n;if(o.isArray(e)){for(var r=[],a=e;o.isArray(a);)r.push(a.length),a=a[0];n=r.reverse()}else if(e instanceof u)n=e.output;else if(e instanceof p)n=e.size;else throw"Unknown dimensions of "+e;if(t)for(n=o.clone(n);3>n.length;)n.push(1);return n}},{key:"pad",value:function(e,t){function n(e){return Array.apply(null,Array(e)).map(Number.prototype.valueOf,0)}for(var r=e.length+2*t,a=e.map(function(e){return[].concat(n(t),e,n(t))}),s=0;s<t;s++)a=[].concat([n(r)],a,[n(r)]);return a}},{key:"flatten2dArrayTo",value:function(e,t){for(var n=0,r=0;r<e.length;r++)t.set(e[r],n),n+=e[r].length}},{key:"flatten3dArrayTo",value:function(e,t){for(var n=0,r=0;r<e.length;r++)for(var a=0;a<e[r].length;a++)t.set(e[r][a],n),n+=e[r][a].length}},{key:"flattenTo",value:function(e,t){o.isArray(e[0])?o.isArray(e[0][0])?o.flatten3dArrayTo(e,t):o.flatten2dArrayTo(e,t):t.set(e)}},{key:"splitArray",value:function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(Array.prototype.slice.call(e,r,r+t));return n}},{key:"getAstString",value:function(e,t){var n=Array.isArray(e)?e:e.split(/\r?\n/g),r=t.loc.start,a=t.loc.end,s=[];s.push(n[r.line-1].slice(r.column));for(var o=r.line;o<a.line-1;o++)s.push(n[o]);return s.push(n[a.line-1].slice(0,a.column)),s.join("\n")}},{key:"allPropertiesOf",value:function(e){var t=[];do t.push.apply(t,Object.getOwnPropertyNames(e));while(e=Object.getPrototypeOf(e));return t}}]),o}(o);Object.assign(g,o),t.exports=g},{"../index":26,"./input":22,"./texture":23,"./utils-core":24}],26:[function(e,t){'use strict';var n=e("./core/gpu"),r=e("./core/alias"),a=e("./core/utils"),s=e("./core/input"),i=e("./core/texture"),o=e("./backend/cpu/function-builder"),p=e("./backend/cpu/function-node"),u=e("./backend/cpu/kernel"),l=e("./backend/cpu/runner"),c=e("./backend/web-gl/function-builder"),d=e("./backend/web-gl/function-node"),h=e("./backend/web-gl/kernel"),m=e("./backend/web-gl/runner");n.alias=r,n.utils=a,n.Texture=i,n.Input=s,n.input=function(e,t){return new s(e,t)},n.CPUFunctionBuilder=o,n.CPUFunctionNode=p,n.CPUKernel=u,n.CPURunner=l,n.WebGLFunctionBuilder=c,n.WebGLFunctionNode=d,n.WebGLKernel=h,n.WebGLRunner=m,"undefined"!=typeof t&&(t.exports=n),"undefined"!=typeof window&&(window.GPU=n)},{"./backend/cpu/function-builder":1,"./backend/cpu/function-node":2,"./backend/cpu/kernel":4,"./backend/cpu/runner":5,"./backend/web-gl/function-builder":11,"./backend/web-gl/function-node":12,"./backend/web-gl/kernel":14,"./backend/web-gl/runner":15,"./core/alias":19,"./core/gpu":21,"./core/input":22,"./core/texture":23,"./core/utils":25}],27:[function(e,t,n){(function(e,r){"object"==typeof n&&"undefined"!=typeof t?r(n):"function"==typeof define&&define.amd?define(["exports"],r):r(e.acorn=e.acorn||{})})(this,function(e){'use strict';function t(e,t){for(var n=65536,r=0;r<t.length;r+=2){if(n+=t[r],n>e)return!1;if(n+=t[r+1],n>=e)return!0}}function n(e,n){return 65>e?36==e:!!(91>e)||(97>e?95==e:!!(123>e)||(65535>=e?170<=e&&S.test(String.fromCharCode(e)):!1!==n&&t(e,E)))}function r(e,n){return 48>e?36==e:!!(58>e)||!(65>e)&&(!!(91>e)||(97>e?95==e:!!(123>e)||(65535>=e?170<=e&&k.test(String.fromCharCode(e)):!1!==n&&(t(e,E)||t(e,v)))))}function a(e,t){return new T(e,{beforeExpr:!0,binop:t})}function s(e,t){return void 0===t&&(t={}),t.keyword=e,P[e]=new T(e,t)}function i(e){return 10===e||13===e||8232===e||8233===e}function o(e,t){return I.call(e,t)}function p(e,t){for(var n=1,r=0;;){w.lastIndex=r;var a=w.exec(e);if(a&&a.index<t)++n,r=a.index+a[0].length;else return new M(n,t-r)}}function u(e){var t={};for(var n in B)t[n]=e&&o(e,n)?e[n]:B[n];if(2015<=t.ecmaVersion&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=5>t.ecmaVersion),D(t.onToken)){var r=t.onToken;t.onToken=function(e){return r.push(e)}}return D(t.onComment)&&(t.onComment=l(t,t.onComment)),t}function l(e,t){return function(n,r,a,s,i,o){var p={type:n?"Block":"Line",value:r,start:a,end:s};e.locations&&(p.loc=new U(this,i,o)),e.ranges&&(p.range=[a,s]),t.push(p)}}function c(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}function d(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=-1}function h(e,t,n,r){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=r),this.options.ranges&&(e.range[1]=n),e}function m(e,t,n,r){try{return new RegExp(e,t)}catch(t){if(void 0!==n)throw t instanceof SyntaxError&&r.raise(n,"Error parsing regular expression: "+t.message),t}}function f(e){return 65535>=e?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(1023&e)+56320))}var g={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",x={5:y,6:y+" const class extends export import super"},b="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",_="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA900-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",S=new RegExp("["+b+"]"),k=new RegExp("["+b+_+"]");b=_=null;var E=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,17,26,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,26,45,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,785,52,76,44,33,24,27,35,42,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,25,391,63,32,0,449,56,264,8,2,36,18,0,50,29,881,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,881,68,12,0,67,12,65,0,32,6124,20,754,9486,1,3071,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,10591,541],v=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,1306,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,52,0,13,2,49,13,10,2,4,9,83,11,7,0,161,11,6,9,7,3,57,0,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,87,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,423,9,838,7,2,7,17,9,57,21,2,13,19882,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239],T=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null},A={beforeExpr:!0},O={startsExpr:!0},P={},N={num:new T("num",O),regexp:new T("regexp",O),string:new T("string",O),name:new T("name",O),eof:new T("eof"),bracketL:new T("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new T("]"),braceL:new T("{",{beforeExpr:!0,startsExpr:!0}),braceR:new T("}"),parenL:new T("(",{beforeExpr:!0,startsExpr:!0}),parenR:new T(")"),comma:new T(",",A),semi:new T(";",A),colon:new T(":",A),dot:new T("."),question:new T("?",A),arrow:new T("=>",A),template:new T("template"),invalidTemplate:new T("invalidTemplate"),ellipsis:new T("...",A),backQuote:new T("`",O),dollarBraceL:new T("${",{beforeExpr:!0,startsExpr:!0}),eq:new T("=",{beforeExpr:!0,isAssign:!0}),assign:new T("_=",{beforeExpr:!0,isAssign:!0}),incDec:new T("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new T("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:a("||",1),logicalAND:a("&&",2),bitwiseOR:a("|",3),bitwiseXOR:a("^",4),bitwiseAND:a("&",5),equality:a("==/!=/===/!==",6),relational:a("</>/<=/>=",7),bitShift:a("<</>>/>>>",8),plusMin:new T("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:a("%",10),star:a("*",10),slash:a("/",10),starstar:new T("**",{beforeExpr:!0}),_break:s("break"),_case:s("case",A),_catch:s("catch"),_continue:s("continue"),_debugger:s("debugger"),_default:s("default",A),_do:s("do",{isLoop:!0,beforeExpr:!0}),_else:s("else",A),_finally:s("finally"),_for:s("for",{isLoop:!0}),_function:s("function",O),_if:s("if"),_return:s("return",A),_switch:s("switch"),_throw:s("throw",A),_try:s("try"),_var:s("var"),_const:s("const"),_while:s("while",{isLoop:!0}),_with:s("with"),_new:s("new",{beforeExpr:!0,startsExpr:!0}),_this:s("this",O),_super:s("super",O),_class:s("class",O),_extends:s("extends",A),_export:s("export"),_import:s("import"),_null:s("null",O),_true:s("true",O),_false:s("false",O),_in:s("in",{beforeExpr:!0,binop:7}),_instanceof:s("instanceof",{beforeExpr:!0,binop:7}),_typeof:s("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:s("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:s("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},C=/\r\n?|\n|\u2028|\u2029/,w=new RegExp(C.source,"g"),F=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,L=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,R=Object.prototype,I=R.hasOwnProperty,G=R.toString,D=Array.isArray||function(e){return"[object Array]"===G.call(e)},M=function(e,t){this.line=e,this.column=t};M.prototype.offset=function(e){return new M(this.line,this.column+e)};var U=function(e,t,n){this.start=t,this.end=n,null!==e.sourceFile&&(this.source=e.sourceFile)},B={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}},V={},K=function(e,t,n){this.options=e=u(e),this.sourceFile=e.sourceFile,this.keywords=c(x[6<=e.ecmaVersion?6:5]);var r="";if(!e.allowReserved){for(var a=e.ecmaVersion;;a--)if(r=g[a])break;"module"==e.sourceType&&(r+=" await")}this.reservedWords=c(r);var s=(r?r+" ":"")+g.strict;this.reservedWordsStrict=c(s),this.reservedWordsStrictBind=c(s+" "+g.strictBind),this.input=t+"",this.containsEsc=!1,this.loadPlugins(e.plugins),n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(C).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=N.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterFunctionScope()};K.prototype.isKeyword=function(e){return this.keywords.test(e)},K.prototype.isReservedWord=function(e){return this.reservedWords.test(e)},K.prototype.extend=function(e,t){this[e]=t(this[e])},K.prototype.loadPlugins=function(e){var t=this;for(var n in e){var r=V[n];if(!r)throw new Error("Plugin '"+n+"' not found");r(t,e[n])}},K.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};var z=K.prototype,j=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)"|;)/;z.strictDirective=function(e){for(var t=this;;){L.lastIndex=e,e+=L.exec(t.input)[0].length;var n=j.exec(t.input.slice(e));if(!n)return!1;if("use strict"==(n[1]||n[2]))return!0;e+=n[0].length}},z.eat=function(e){return!(this.type!==e)&&(this.next(),!0)},z.isContextual=function(e){return this.type===N.name&&this.value===e},z.eatContextual=function(e){return this.value===e&&this.eat(N.name)},z.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},z.canInsertSemicolon=function(){return this.type===N.eof||this.type===N.braceR||C.test(this.input.slice(this.lastTokEnd,this.start))},z.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},z.semicolon=function(){this.eat(N.semi)||this.insertSemicolon()||this.unexpected()},z.afterTrailingComma=function(e,t){if(this.type==e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},z.expect=function(e){this.eat(e)||this.unexpected()},z.unexpected=function(e){this.raise(null==e?this.start:e,"Unexpected token")},z.checkPatternErrors=function(e,t){if(e){-1<e.trailingComma&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;-1<n&&this.raiseRecoverable(n,"Parenthesized pattern")}},z.checkExpressionErrors=function(e,t){var n=e?e.shorthandAssign:-1;return t?void(-1<n&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns")):0<=n},z.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},z.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var W=K.prototype;W.parseTopLevel=function(e){var t=this,n={};for(e.body||(e.body=[]);this.type!==N.eof;){var r=t.parseStatement(!0,!0,n);e.body.push(r)}return this.adaptDirectivePrologue(e.body),this.next(),6<=this.options.ecmaVersion&&(e.sourceType=this.options.sourceType),this.finishNode(e,"Program")};var X={kind:"loop"},q={kind:"switch"};W.isLet=function(){if(this.type!==N.name||6>this.options.ecmaVersion||"let"!=this.value)return!1;L.lastIndex=this.pos;var e=L.exec(this.input),t=this.pos+e[0].length,a=this.input.charCodeAt(t);if(91===a||123==a)return!0;if(n(a,!0)){for(var s=t+1;r(this.input.charCodeAt(s),!0);)++s;var i=this.input.slice(t,s);if(!this.isKeyword(i))return!0}return!1},W.isAsyncFunction=function(){if(this.type!==N.name||8>this.options.ecmaVersion||"async"!=this.value)return!1;L.lastIndex=this.pos;var e=L.exec(this.input),t=this.pos+e[0].length;return!C.test(this.input.slice(this.pos,t))&&"function"===this.input.slice(t,t+8)&&(t+8==this.input.length||!r(this.input.charAt(t+8)))},W.parseStatement=function(e,t,n){var r,a=this.type,s=this.startNode();switch(this.isLet()&&(a=N._var,r="let"),a){case N._break:case N._continue:return this.parseBreakContinueStatement(s,a.keyword);case N._debugger:return this.parseDebuggerStatement(s);case N._do:return this.parseDoStatement(s);case N._for:return this.parseForStatement(s);case N._function:return!e&&6<=this.options.ecmaVersion&&this.unexpected(),this.parseFunctionStatement(s,!1);case N._class:return e||this.unexpected(),this.parseClass(s,!0);case N._if:return this.parseIfStatement(s);case N._return:return this.parseReturnStatement(s);case N._switch:return this.parseSwitchStatement(s);case N._throw:return this.parseThrowStatement(s);case N._try:return this.parseTryStatement(s);case N._const:case N._var:return r=r||this.value,e||"var"==r||this.unexpected(),this.parseVarStatement(s,r);case N._while:return this.parseWhileStatement(s);case N._with:return this.parseWithStatement(s);case N.braceL:return this.parseBlock();case N.semi:return this.parseEmptyStatement(s);case N._export:case N._import:return this.options.allowImportExportEverywhere||(!t&&this.raise(this.start,"'import' and 'export' may only appear at the top level"),!this.inModule&&this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),a===N._import?this.parseImport(s):this.parseExport(s,n);default:if(this.isAsyncFunction()&&e)return this.next(),this.parseFunctionStatement(s,!0);var i=this.value,o=this.parseExpression();return a===N.name&&"Identifier"===o.type&&this.eat(N.colon)?this.parseLabeledStatement(s,i,o):this.parseExpressionStatement(s,o);}},W.parseBreakContinueStatement=function(e,t){var n=this,r="break"==t;this.next(),this.eat(N.semi)||this.insertSemicolon()?e.label=null:this.type===N.name?(e.label=this.parseIdent(),this.semicolon()):this.unexpected();for(var a,s=0;s<this.labels.length;++s)if(a=n.labels[s],null==e.label||a.name===e.label.name){if(null!=a.kind&&(r||"loop"===a.kind))break;if(e.label&&r)break}return s===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,r?"BreakStatement":"ContinueStatement")},W.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},W.parseDoStatement=function(e){return this.next(),this.labels.push(X),e.body=this.parseStatement(!1),this.labels.pop(),this.expect(N._while),e.test=this.parseParenExpression(),6<=this.options.ecmaVersion?this.eat(N.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},W.parseForStatement=function(e){if(this.next(),this.labels.push(X),this.enterLexicalScope(),this.expect(N.parenL),this.type===N.semi)return this.parseFor(e,null);var t=this.isLet();if(this.type===N._var||this.type===N._const||t){var n=this.startNode(),r=t?"let":this.value;return this.next(),this.parseVar(n,!0,r),this.finishNode(n,"VariableDeclaration"),(this.type===N._in||6<=this.options.ecmaVersion&&this.isContextual("of"))&&1===n.declarations.length&&!("var"!==r&&n.declarations[0].init)?this.parseForIn(e,n):this.parseFor(e,n)}var a=new d,s=this.parseExpression(!0,a);return this.type===N._in||6<=this.options.ecmaVersion&&this.isContextual("of")?(this.toAssignable(s),this.checkLVal(s),this.checkPatternErrors(a,!0),this.parseForIn(e,s)):(this.checkExpressionErrors(a,!0),this.parseFor(e,s))},W.parseFunctionStatement=function(e,t){return this.next(),this.parseFunction(e,!0,!1,t)},W.isFunction=function(){return this.type===N._function||this.isAsyncFunction()},W.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement(!this.strict&&this.isFunction()),e.alternate=this.eat(N._else)?this.parseStatement(!this.strict&&this.isFunction()):null,this.finishNode(e,"IfStatement")},W.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(N.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},W.parseSwitchStatement=function(e){var t=this;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(N.braceL),this.labels.push(q),this.enterLexicalScope();for(var n,r=!1;this.type!=N.braceR;)if(t.type===N._case||t.type===N._default){var a=t.type===N._case;n&&t.finishNode(n,"SwitchCase"),e.cases.push(n=t.startNode()),n.consequent=[],t.next(),a?n.test=t.parseExpression():(r&&t.raiseRecoverable(t.lastTokStart,"Multiple default clauses"),r=!0,n.test=null),t.expect(N.colon)}else n||t.unexpected(),n.consequent.push(t.parseStatement(!0));return this.exitLexicalScope(),n&&this.finishNode(n,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},W.parseThrowStatement=function(e){return this.next(),C.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var Y=[];W.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===N._catch){var t=this.startNode();this.next(),this.expect(N.parenL),t.param=this.parseBindingAtom(),this.enterLexicalScope(),this.checkLVal(t.param,"let"),this.expect(N.parenR),t.body=this.parseBlock(!1),this.exitLexicalScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(N._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},W.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},W.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(X),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"WhileStatement")},W.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement(!1),this.finishNode(e,"WithStatement")},W.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},W.parseLabeledStatement=function(e,t,n){for(var r,a=this,s=0,o=a.labels;s<o.length;s+=1)r=o[s],r.name===t&&a.raise(n.start,"Label '"+t+"' is already declared");for(var p,u=this.type.isLoop?"loop":this.type===N._switch?"switch":null,l=this.labels.length-1;0<=l&&(p=a.labels[l],p.statementStart==e.start);l--)p.statementStart=a.start,p.kind=u;return this.labels.push({name:t,kind:u,statementStart:this.start}),e.body=this.parseStatement(!0),("ClassDeclaration"==e.body.type||"VariableDeclaration"==e.body.type&&"var"!=e.body.kind||"FunctionDeclaration"==e.body.type&&(this.strict||e.body.generator))&&this.raiseRecoverable(e.body.start,"Invalid labeled declaration"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")},W.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},W.parseBlock=function(e){var t=this;void 0===e&&(e=!0);var n=this.startNode();for(n.body=[],this.expect(N.braceL),e&&this.enterLexicalScope();!this.eat(N.braceR);){var r=t.parseStatement(!0);n.body.push(r)}return e&&this.exitLexicalScope(),this.finishNode(n,"BlockStatement")},W.parseFor=function(e,t){return e.init=t,this.expect(N.semi),e.test=this.type===N.semi?null:this.parseExpression(),this.expect(N.semi),e.update=this.type===N.parenR?null:this.parseExpression(),this.expect(N.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"ForStatement")},W.parseForIn=function(e,t){var n=this.type===N._in?"ForInStatement":"ForOfStatement";return this.next(),e.left=t,e.right=this.parseExpression(),this.expect(N.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,n)},W.parseVar=function(e,t,n){var r=this;for(e.declarations=[],e.kind=n;;){var a=r.startNode();if(r.parseVarId(a,n),r.eat(N.eq)?a.init=r.parseMaybeAssign(t):"const"!==n||r.type===N._in||6<=r.options.ecmaVersion&&r.isContextual("of")?"Identifier"==a.id.type||t&&(r.type===N._in||r.isContextual("of"))?a.init=null:r.raise(r.lastTokEnd,"Complex binding patterns require an initialization value"):r.unexpected(),e.declarations.push(r.finishNode(a,"VariableDeclarator")),!r.eat(N.comma))break}return e},W.parseVarId=function(e,t){e.id=this.parseBindingAtom(t),this.checkLVal(e.id,t,!1)},W.parseFunction=function(e,t,n,r){this.initFunction(e),6<=this.options.ecmaVersion&&!r&&(e.generator=this.eat(N.star)),8<=this.options.ecmaVersion&&(e.async=!!r),t&&(e.id="nullableID"===t&&this.type!=N.name?null:this.parseIdent(),e.id&&this.checkLVal(e.id,"var"));var a=this.inGenerator,s=this.inAsync,i=this.yieldPos,o=this.awaitPos,p=this.inFunction;return this.inGenerator=e.generator,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),t||(e.id=this.type==N.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n),this.inGenerator=a,this.inAsync=s,this.yieldPos=i,this.awaitPos=o,this.inFunction=p,this.finishNode(e,t?"FunctionDeclaration":"FunctionExpression")},W.parseFunctionParams=function(e){this.expect(N.parenL),e.params=this.parseBindingList(N.parenR,!1,8<=this.options.ecmaVersion),this.checkYieldAwaitInDefaultParams()},W.parseClass=function(e,t){var n=this;this.next(),this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),a=!1;for(r.body=[],this.expect(N.braceL);!this.eat(N.braceR);)if(!n.eat(N.semi)){var s=n.startNode(),i=n.eat(N.star),o=!1,p=n.type===N.name&&"static"===n.value;n.parsePropertyName(s),s.static=p&&n.type!==N.parenL,s.static&&(i&&n.unexpected(),i=n.eat(N.star),n.parsePropertyName(s)),!(8<=n.options.ecmaVersion)||i||s.computed||"Identifier"!==s.key.type||"async"!==s.key.name||n.type===N.parenL||n.canInsertSemicolon()||(o=!0,n.parsePropertyName(s)),s.kind="method";var u=!1;if(!s.computed){var l=s.key;i||o||"Identifier"!==l.type||n.type===N.parenL||"get"!==l.name&&"set"!==l.name||(u=!0,s.kind=l.name,l=n.parsePropertyName(s)),s.static||("Identifier"!==l.type||"constructor"!==l.name)&&("Literal"!==l.type||"constructor"!==l.value)||(a&&n.raise(l.start,"Duplicate constructor in the same class"),u&&n.raise(l.start,"Constructor can't have get/set modifier"),i&&n.raise(l.start,"Constructor can't be a generator"),o&&n.raise(l.start,"Constructor can't be an async method"),s.kind="constructor",a=!0)}if(n.parseClassMethod(r,s,i,o),u){var c="get"===s.kind?0:1;if(s.value.params.length!==c){var d=s.value.start;"get"===s.kind?n.raiseRecoverable(d,"getter should have no params"):n.raiseRecoverable(d,"setter should have exactly one param")}else"set"===s.kind&&"RestElement"===s.value.params[0].type&&n.raiseRecoverable(s.value.params[0].start,"Setter cannot use rest params")}}return e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},W.parseClassMethod=function(e,t,n,r){t.value=this.parseMethod(n,r),e.body.push(this.finishNode(t,"MethodDefinition"))},W.parseClassId=function(e,t){e.id=this.type===N.name?this.parseIdent():!0===t?this.unexpected():null},W.parseClassSuper=function(e){e.superClass=this.eat(N._extends)?this.parseExprSubscripts():null},W.parseExport=function(e,t){var n=this;if(this.next(),this.eat(N.star))return this.expectContextual("from"),e.source=this.type===N.string?this.parseExprAtom():this.unexpected(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(N._default)){this.checkExport(t,"default",this.lastTokStart);var r;if(this.type===N._function||(r=this.isAsyncFunction())){var a=this.startNode();this.next(),r&&this.next(),e.declaration=this.parseFunction(a,"nullableID",!1,r)}else if(this.type===N._class){var s=this.startNode();e.declaration=this.parseClass(s,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(!0),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))e.source=this.type===N.string?this.parseExprAtom():this.unexpected();else{for(var o,p=0,u=e.specifiers;p<u.length;p+=1)o=u[p],n.checkUnreserved(o.local);e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},W.checkExport=function(e,t,n){e&&(o(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)},W.checkPatternExport=function(e,t){var n=this,r=t.type;if("Identifier"==r)this.checkExport(e,t.name,t.start);else if("ObjectPattern"==r)for(var a,s=0,o=t.properties;s<o.length;s+=1)a=o[s],n.checkPatternExport(e,a.value);else if("ArrayPattern"==r)for(var p,u=0,l=t.elements;u<l.length;u+=1)p=l[u],p&&n.checkPatternExport(e,p);else"AssignmentPattern"==r?this.checkPatternExport(e,t.left):"ParenthesizedExpression"==r&&this.checkPatternExport(e,t.expression)},W.checkVariableExport=function(e,t){var n=this;if(e)for(var r,a=0,s=t;a<s.length;a+=1)r=s[a],n.checkPatternExport(e,r.id)},W.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},W.parseExportSpecifiers=function(e){var t=this,n=[],r=!0;for(this.expect(N.braceL);!this.eat(N.braceR);){if(!!r)r=!1;else if(t.expect(N.comma),t.afterTrailingComma(N.braceR))break;var a=t.startNode();a.local=t.parseIdent(!0),a.exported=t.eatContextual("as")?t.parseIdent(!0):a.local,t.checkExport(e,a.exported.name,a.exported.start),n.push(t.finishNode(a,"ExportSpecifier"))}return n},W.parseImport=function(e){return this.next(),this.type===N.string?(e.specifiers=Y,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===N.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},W.parseImportSpecifiers=function(){var e=this,t=[],n=!0;if(this.type===N.name){var r=this.startNode();if(r.local=this.parseIdent(),this.checkLVal(r.local,"let"),t.push(this.finishNode(r,"ImportDefaultSpecifier")),!this.eat(N.comma))return t}if(this.type===N.star){var a=this.startNode();return this.next(),this.expectContextual("as"),a.local=this.parseIdent(),this.checkLVal(a.local,"let"),t.push(this.finishNode(a,"ImportNamespaceSpecifier")),t}for(this.expect(N.braceL);!this.eat(N.braceR);){if(!!n)n=!1;else if(e.expect(N.comma),e.afterTrailingComma(N.braceR))break;var s=e.startNode();s.imported=e.parseIdent(!0),e.eatContextual("as")?s.local=e.parseIdent():(e.checkUnreserved(s.imported),s.local=s.imported),e.checkLVal(s.local,"let"),t.push(e.finishNode(s,"ImportSpecifier"))}return t},W.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},W.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&("\""===this.input[e.start]||"'"===this.input[e.start])};var H=K.prototype;H.toAssignable=function(e,t){var n=this;if(6<=this.options.ecmaVersion&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":break;case"ObjectExpression":e.type="ObjectPattern";for(var r,a=0,s=e.properties;a<s.length;a+=1)r=s[a],"init"!==r.kind&&n.raise(r.key.start,"Object pattern can't contain getter or setter"),n.toAssignable(r.value,t);break;case"ArrayExpression":e.type="ArrayPattern",this.toAssignableList(e.elements,t);break;case"AssignmentExpression":if("="===e.operator)e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);else{this.raise(e.left.end,"Only '=' operator can be used for specifying default value.");break}case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t);break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue");}return e},H.toAssignableList=function(e,t){var n=this,r=e.length;if(r){var a=e[r-1];if(a&&"RestElement"==a.type)--r;else if(a&&"SpreadElement"==a.type){a.type="RestElement";var s=a.argument;this.toAssignable(s,t),--r}6===this.options.ecmaVersion&&t&&a&&"RestElement"===a.type&&"Identifier"!==a.argument.type&&this.unexpected(a.argument.start)}for(var o,p=0;p<r;p++)o=e[p],o&&n.toAssignable(o,t);return e},H.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},H.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==N.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},H.parseBindingAtom=function(){if(6<=this.options.ecmaVersion)switch(this.type){case N.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(N.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case N.braceL:return this.parseObj(!0);}return this.parseIdent()},H.parseBindingList=function(e,t,n){for(var r=this,a=[],s=!0;!this.eat(e);)if(s?s=!1:r.expect(N.comma),t&&r.type===N.comma)a.push(null);else if(n&&r.afterTrailingComma(e))break;else if(r.type===N.ellipsis){var i=r.parseRestBinding();r.parseBindingListItem(i),a.push(i),r.type===N.comma&&r.raise(r.start,"Comma is not permitted after the rest element"),r.expect(e);break}else{var o=r.parseMaybeDefault(r.start,r.startLoc);r.parseBindingListItem(o),a.push(o)}return a},H.parseBindingListItem=function(e){return e},H.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),6>this.options.ecmaVersion||!this.eat(N.eq))return n;var r=this.startNodeAt(e,t);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},H.checkLVal=function(e,t,n){var r=this;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(o(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),t&&"none"!==t&&(("var"===t&&!this.canDeclareVarName(e.name)||"var"!==t&&!this.canDeclareLexicalName(e.name))&&this.raiseRecoverable(e.start,"Identifier '"+e.name+"' has already been declared"),"var"===t?this.declareVarName(e.name):this.declareLexicalName(e.name));break;case"MemberExpression":t&&this.raiseRecoverable(e.start,(t?"Binding":"Assigning to")+" member expression");break;case"ObjectPattern":for(var a,s=0,p=e.properties;s<p.length;s+=1)a=p[s],r.checkLVal(a.value,t,n);break;case"ArrayPattern":for(var u,l=0,c=e.elements;l<c.length;l+=1)u=c[l],u&&r.checkLVal(u,t,n);break;case"AssignmentPattern":this.checkLVal(e.left,t,n);break;case"RestElement":this.checkLVal(e.argument,t,n);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,n);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue");}};var Z=K.prototype;Z.checkPropClash=function(e,t){if(!(6<=this.options.ecmaVersion&&(e.computed||e.method||e.shorthand))){var n,r=e.key;switch(r.type){case"Identifier":n=r.name;break;case"Literal":n=r.value+"";break;default:return;}var a=e.kind;if(6<=this.options.ecmaVersion)return void("__proto__"===n&&"init"===a&&(t.proto&&this.raiseRecoverable(r.start,"Redefinition of __proto__ property"),t.proto=!0));n="$"+n;var s=t[n];if(s){var i;i="init"===a?this.strict&&s.init||s.get||s.set:s.init||s[a],i&&this.raiseRecoverable(r.start,"Redefinition of property")}else s=t[n]={init:!1,get:!1,set:!1};s[a]=!0}},Z.parseExpression=function(e,t){var n=this,r=this.start,a=this.startLoc,s=this.parseMaybeAssign(e,t);if(this.type===N.comma){var i=this.startNodeAt(r,a);for(i.expressions=[s];this.eat(N.comma);)i.expressions.push(n.parseMaybeAssign(e,t));return this.finishNode(i,"SequenceExpression")}return s},Z.parseMaybeAssign=function(e,t,n){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var r=!1,a=-1,s=-1;t?(a=t.parenthesizedAssign,s=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new d,r=!0);var i=this.start,o=this.startLoc;(this.type==N.parenL||this.type==N.name)&&(this.potentialArrowAt=this.start);var p=this.parseMaybeConditional(e,t);if(n&&(p=n.call(this,p,i,o)),this.type.isAssign){this.checkPatternErrors(t,!0),r||d.call(t);var u=this.startNodeAt(i,o);return u.operator=this.value,u.left=this.type===N.eq?this.toAssignable(p):p,t.shorthandAssign=-1,this.checkLVal(p),this.next(),u.right=this.parseMaybeAssign(e),this.finishNode(u,"AssignmentExpression")}return r&&this.checkExpressionErrors(t,!0),-1<a&&(t.parenthesizedAssign=a),-1<s&&(t.trailingComma=s),p},Z.parseMaybeConditional=function(e,t){var n=this.start,r=this.startLoc,a=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return a;if(this.eat(N.question)){var s=this.startNodeAt(n,r);return s.test=a,s.consequent=this.parseMaybeAssign(),this.expect(N.colon),s.alternate=this.parseMaybeAssign(e),this.finishNode(s,"ConditionalExpression")}return a},Z.parseExprOps=function(e,t){var n=this.start,r=this.startLoc,a=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)?a:a.start==n&&"ArrowFunctionExpression"===a.type?a:this.parseExprOp(a,n,r,-1,e)},Z.parseExprOp=function(e,t,n,r,a){var s=this.type.binop;if(null!=s&&(!a||this.type!==N._in)&&s>r){var i=this.type===N.logicalOR||this.type===N.logicalAND,o=this.value;this.next();var p=this.start,u=this.startLoc,l=this.parseExprOp(this.parseMaybeUnary(null,!1),p,u,s,a),c=this.buildBinary(t,n,e,l,o,i);return this.parseExprOp(c,t,n,r,a)}return e},Z.buildBinary=function(e,t,n,r,a,s){var i=this.startNodeAt(e,t);return i.left=n,i.operator=a,i.right=r,this.finishNode(i,s?"LogicalExpression":"BinaryExpression")},Z.parseMaybeUnary=function(e,t){var n,r=this,a=this.start,s=this.startLoc;if(this.inAsync&&this.isContextual("await"))n=this.parseAwait(),t=!0;else if(this.type.prefix){var i=this.startNode(),o=this.type===N.incDec;i.operator=this.value,i.prefix=!0,this.next(),i.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),o?this.checkLVal(i.argument):this.strict&&"delete"===i.operator&&"Identifier"===i.argument.type?this.raiseRecoverable(i.start,"Deleting local variable in strict mode"):t=!0,n=this.finishNode(i,o?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var p=r.startNodeAt(a,s);p.operator=r.value,p.prefix=!1,p.argument=n,r.checkLVal(n),r.next(),n=r.finishNode(p,"UpdateExpression")}}return!t&&this.eat(N.starstar)?this.buildBinary(a,s,n,this.parseMaybeUnary(null,!1),"**",!1):n},Z.parseExprSubscripts=function(e){var t=this.start,n=this.startLoc,r=this.parseExprAtom(e),a="ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(e)||a)return r;var s=this.parseSubscripts(r,t,n);return e&&"MemberExpression"===s.type&&(e.parenthesizedAssign>=s.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=s.start&&(e.parenthesizedBind=-1)),s},Z.parseSubscripts=function(e,t,n,r){for(var a=this,s=8<=this.options.ecmaVersion&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd==e.end&&!this.canInsertSemicolon(),i=void 0;;)if((i=a.eat(N.bracketL))||a.eat(N.dot)){var o=a.startNodeAt(t,n);o.object=e,o.property=i?a.parseExpression():a.parseIdent(!0),o.computed=!!i,i&&a.expect(N.bracketR),e=a.finishNode(o,"MemberExpression")}else if(!r&&a.eat(N.parenL)){var p=new d,u=a.yieldPos,l=a.awaitPos;a.yieldPos=0,a.awaitPos=0;var c=a.parseExprList(N.parenR,8<=a.options.ecmaVersion,!1,p);if(s&&!a.canInsertSemicolon()&&a.eat(N.arrow))return a.checkPatternErrors(p,!1),a.checkYieldAwaitInDefaultParams(),a.yieldPos=u,a.awaitPos=l,a.parseArrowExpression(a.startNodeAt(t,n),c,!0);a.checkExpressionErrors(p,!0),a.yieldPos=u||a.yieldPos,a.awaitPos=l||a.awaitPos;var h=a.startNodeAt(t,n);h.callee=e,h.arguments=c,e=a.finishNode(h,"CallExpression")}else if(a.type===N.backQuote){var m=a.startNodeAt(t,n);m.tag=e,m.quasi=a.parseTemplate({isTagged:!0}),e=a.finishNode(m,"TaggedTemplateExpression")}else return e},Z.parseExprAtom=function(e){var t,n=this.potentialArrowAt==this.start;switch(this.type){case N._super:return this.inFunction||this.raise(this.start,"'super' outside of function or class"),t=this.startNode(),this.next(),this.type!==N.dot&&this.type!==N.bracketL&&this.type!==N.parenL&&this.unexpected(),this.finishNode(t,"Super");case N._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case N.name:var r=this.start,a=this.startLoc,s=this.parseIdent(this.type!==N.name);if(8<=this.options.ecmaVersion&&"async"===s.name&&!this.canInsertSemicolon()&&this.eat(N._function))return this.parseFunction(this.startNodeAt(r,a),!1,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(N.arrow))return this.parseArrowExpression(this.startNodeAt(r,a),[s],!1);if(8<=this.options.ecmaVersion&&"async"===s.name&&this.type===N.name)return s=this.parseIdent(),(this.canInsertSemicolon()||!this.eat(N.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,a),[s],!0)}return s;case N.regexp:var i=this.value;return t=this.parseLiteral(i.value),t.regex={pattern:i.pattern,flags:i.flags},t;case N.num:case N.string:return this.parseLiteral(this.value);case N._null:case N._true:case N._false:return t=this.startNode(),t.value=this.type===N._null?null:this.type===N._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case N.parenL:var o=this.start,p=this.parseParenAndDistinguishExpression(n);return e&&(0>e.parenthesizedAssign&&!this.isSimpleAssignTarget(p)&&(e.parenthesizedAssign=o),0>e.parenthesizedBind&&(e.parenthesizedBind=o)),p;case N.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(N.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case N.braceL:return this.parseObj(!1,e);case N._function:return t=this.startNode(),this.next(),this.parseFunction(t,!1);case N._class:return this.parseClass(this.startNode(),!1);case N._new:return this.parseNew();case N.backQuote:return this.parseTemplate();default:this.unexpected();}},Z.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(t,"Literal")},Z.parseParenExpression=function(){this.expect(N.parenL);var e=this.parseExpression();return this.expect(N.parenR),e},Z.parseParenAndDistinguishExpression=function(e){var t,n=this,r=this.start,a=this.startLoc,s=8<=this.options.ecmaVersion;if(6<=this.options.ecmaVersion){this.next();var i,o,p=this.start,u=this.startLoc,l=[],c=!0,h=!1,m=new d,f=this.yieldPos,g=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==N.parenR;)if(c?c=!1:n.expect(N.comma),s&&n.afterTrailingComma(N.parenR,!0)){h=!0;break}else if(n.type===N.ellipsis){i=n.start,l.push(n.parseParenItem(n.parseRestBinding())),n.type===N.comma&&n.raise(n.start,"Comma is not permitted after the rest element");break}else n.type!==N.parenL||o||(o=n.start),l.push(n.parseMaybeAssign(!1,m,n.parseParenItem));var y=this.start,x=this.startLoc;if(this.expect(N.parenR),e&&!this.canInsertSemicolon()&&this.eat(N.arrow))return this.checkPatternErrors(m,!1),this.checkYieldAwaitInDefaultParams(),o&&this.unexpected(o),this.yieldPos=f,this.awaitPos=g,this.parseParenArrowList(r,a,l);(!l.length||h)&&this.unexpected(this.lastTokStart),i&&this.unexpected(i),this.checkExpressionErrors(m,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=g||this.awaitPos,1<l.length?(t=this.startNodeAt(p,u),t.expressions=l,this.finishNodeAt(t,"SequenceExpression",y,x)):t=l[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var b=this.startNodeAt(r,a);return b.expression=t,this.finishNode(b,"ParenthesizedExpression")}return t},Z.parseParenItem=function(e){return e},Z.parseParenArrowList=function(e,t,n){return this.parseArrowExpression(this.startNodeAt(e,t),n)};var J=[];Z.parseNew=function(){var e=this.startNode(),t=this.parseIdent(!0);if(6<=this.options.ecmaVersion&&this.eat(N.dot))return e.meta=t,e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(e.start,"new.target can only be used in functions"),this.finishNode(e,"MetaProperty");var n=this.start,r=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(),n,r,!0),e.arguments=this.eat(N.parenL)?this.parseExprList(N.parenR,8<=this.options.ecmaVersion,!1):J,this.finishNode(e,"NewExpression")},Z.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===N.invalidTemplate?(!t&&this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===N.backQuote,this.finishNode(n,"TemplateElement")},Z.parseTemplate=function(e){var t=this;void 0===e&&(e={});var n=e.isTagged;void 0===n&&(n=!1);var r=this.startNode();this.next(),r.expressions=[];var a=this.parseTemplateElement({isTagged:n});for(r.quasis=[a];!a.tail;)t.expect(N.dollarBraceL),r.expressions.push(t.parseExpression()),t.expect(N.braceR),r.quasis.push(a=t.parseTemplateElement({isTagged:n}));return this.next(),this.finishNode(r,"TemplateLiteral")},Z.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===N.name||this.type===N.num||this.type===N.string||this.type===N.bracketL||this.type.keyword)&&!C.test(this.input.slice(this.lastTokEnd,this.start))},Z.parseObj=function(e,t){var n=this,r=this.startNode(),a=!0,s={};for(r.properties=[],this.next();!this.eat(N.braceR);){if(!!a)a=!1;else if(n.expect(N.comma),n.afterTrailingComma(N.braceR))break;var i=n.parseProperty(e,t);n.checkPropClash(i,s),r.properties.push(i)}return this.finishNode(r,e?"ObjectPattern":"ObjectExpression")},Z.parseProperty=function(e,t){var n,r,a,s,i=this.startNode();return 6<=this.options.ecmaVersion&&(i.method=!1,i.shorthand=!1,(e||t)&&(a=this.start,s=this.startLoc),!e&&(n=this.eat(N.star))),this.parsePropertyName(i),!e&&8<=this.options.ecmaVersion&&!n&&this.isAsyncProp(i)?(r=!0,this.parsePropertyName(i,t)):r=!1,this.parsePropertyValue(i,e,n,r,a,s,t),this.finishNode(i,"Property")},Z.parsePropertyValue=function(e,t,n,r,a,s,i){if((n||r)&&this.type===N.colon&&this.unexpected(),this.eat(N.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,i),e.kind="init";else if(6<=this.options.ecmaVersion&&this.type===N.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,r);else if(!t&&5<=this.options.ecmaVersion&&!e.computed&&"Identifier"===e.key.type&&("get"===e.key.name||"set"===e.key.name)&&this.type!=N.comma&&this.type!=N.braceR){(n||r)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var o="get"===e.kind?0:1;if(e.value.params.length!==o){var p=e.value.start;"get"===e.kind?this.raiseRecoverable(p,"getter should have no params"):this.raiseRecoverable(p,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}else 6<=this.options.ecmaVersion&&!e.computed&&"Identifier"===e.key.type?(this.checkUnreserved(e.key),e.kind="init",t?e.value=this.parseMaybeDefault(a,s,e.key):this.type===N.eq&&i?(0>i.shorthandAssign&&(i.shorthandAssign=this.start),e.value=this.parseMaybeDefault(a,s,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected()},Z.parsePropertyName=function(e){if(6<=this.options.ecmaVersion){if(this.eat(N.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(N.bracketR),e.key;e.computed=!1}return e.key=this.type===N.num||this.type===N.string?this.parseExprAtom():this.parseIdent(!0)},Z.initFunction=function(e){e.id=null,6<=this.options.ecmaVersion&&(e.generator=!1,e.expression=!1),8<=this.options.ecmaVersion&&(e.async=!1)},Z.parseMethod=function(e,t){var n=this.startNode(),r=this.inGenerator,a=this.inAsync,s=this.yieldPos,i=this.awaitPos,o=this.inFunction;return this.initFunction(n),6<=this.options.ecmaVersion&&(n.generator=e),8<=this.options.ecmaVersion&&(n.async=!!t),this.inGenerator=n.generator,this.inAsync=n.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),this.expect(N.parenL),n.params=this.parseBindingList(N.parenR,!1,8<=this.options.ecmaVersion),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1),this.inGenerator=r,this.inAsync=a,this.yieldPos=s,this.awaitPos=i,this.inFunction=o,this.finishNode(n,"FunctionExpression")},Z.parseArrowExpression=function(e,t,n){var r=this.inGenerator,a=this.inAsync,s=this.yieldPos,i=this.awaitPos,o=this.inFunction;return this.enterFunctionScope(),this.initFunction(e),8<=this.options.ecmaVersion&&(e.async=!!n),this.inGenerator=!1,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0),this.inGenerator=r,this.inAsync=a,this.yieldPos=s,this.awaitPos=i,this.inFunction=o,this.finishNode(e,"ArrowFunctionExpression")},Z.parseFunctionBody=function(e,t){var n=t&&this.type!==N.braceL,r=this.strict,a=!1;if(n)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var s=7<=this.options.ecmaVersion&&!this.isSimpleParamList(e.params);(!r||s)&&(a=this.strictDirective(this.end),a&&s&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var i=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(e,!r&&!a&&!t&&this.isSimpleParamList(e.params)),e.body=this.parseBlock(!1),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=i}this.exitFunctionScope(),this.strict&&e.id&&this.checkLVal(e.id,"none"),this.strict=r},Z.isSimpleParamList=function(e){for(var t,n=0,r=e;n<r.length;n+=1)if(t=r[n],"Identifier"!==t.type)return!1;return!0},Z.checkParams=function(e,t){for(var n,r=this,a={},s=0,o=e.params;s<o.length;s+=1)n=o[s],r.checkLVal(n,"var",t?null:a)},Z.parseExprList=function(e,t,n,r){for(var a=this,s=[],i=!0;!this.eat(e);){if(!!i)i=!1;else if(a.expect(N.comma),t&&a.afterTrailingComma(e))break;var o=void 0;n&&a.type===N.comma?o=null:a.type===N.ellipsis?(o=a.parseSpread(r),r&&a.type===N.comma&&0>r.trailingComma&&(r.trailingComma=a.start)):o=a.parseMaybeAssign(!1,r),s.push(o)}return s},Z.checkUnreserved=function(e){var t=e.start,n=e.end,r=e.name;if(this.inGenerator&&"yield"===r&&this.raiseRecoverable(t,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(t,"Can not use 'await' as identifier inside an async function"),this.isKeyword(r)&&this.raise(t,"Unexpected keyword '"+r+"'"),!(6>this.options.ecmaVersion&&-1!=this.input.slice(t,n).indexOf("\\"))){var a=this.strict?this.reservedWordsStrict:this.reservedWords;a.test(r)&&this.raiseRecoverable(t,"The keyword '"+r+"' is reserved")}},Z.parseIdent=function(e){var t=this.startNode();return e&&"never"==this.options.allowReserved&&(e=!1),this.type===N.name?t.name=this.value:this.type.keyword?(t.name=this.type.keyword,("class"===t.name||"function"===t.name)&&(this.lastTokEnd!==this.lastTokStart+1||46!==this.input.charCodeAt(this.lastTokStart))&&this.context.pop()):this.unexpected(),this.next(),this.finishNode(t,"Identifier"),e||this.checkUnreserved(t),t},Z.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type==N.semi||this.canInsertSemicolon()||this.type!=N.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(N.star),e.argument=this.parseMaybeAssign()),this.finishNode(e,"YieldExpression")},Z.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0),this.finishNode(e,"AwaitExpression")};var $=K.prototype;$.raise=function(e,t){var n=p(this.input,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=this.pos,r},$.raiseRecoverable=$.raise,$.curPosition=function(){if(this.options.locations)return new M(this.curLine,this.pos-this.lineStart)};var Q=K.prototype,ee=Object.assign||function(e){for(var t=[],n=arguments.length-1;0<n--;)t[n]=arguments[n+1];for(var r,a=0,s=t;a<s.length;a+=1)for(var p in r=s[a],r)o(r,p)&&(e[p]=r[p]);return e};Q.enterFunctionScope=function(){this.scopeStack.push({var:{},lexical:{},childVar:{},parentLexical:{}})},Q.exitFunctionScope=function(){this.scopeStack.pop()},Q.enterLexicalScope=function(){var e=this.scopeStack[this.scopeStack.length-1],t={var:{},lexical:{},childVar:{},parentLexical:{}};this.scopeStack.push(t),ee(t.parentLexical,e.lexical,e.parentLexical)},Q.exitLexicalScope=function(){var e=this.scopeStack.pop(),t=this.scopeStack[this.scopeStack.length-1];ee(t.childVar,e.var,e.childVar)},Q.canDeclareVarName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!o(t.lexical,e)&&!o(t.parentLexical,e)},Q.canDeclareLexicalName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!o(t.lexical,e)&&!o(t.var,e)&&!o(t.childVar,e)},Q.declareVarName=function(e){this.scopeStack[this.scopeStack.length-1].var[e]=!0},Q.declareLexicalName=function(e){this.scopeStack[this.scopeStack.length-1].lexical[e]=!0};var te=function(e,t,n){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new U(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},ne=K.prototype;ne.startNode=function(){return new te(this,this.start,this.startLoc)},ne.startNodeAt=function(e,t){return new te(this,e,t)},ne.finishNode=function(e,t){return h.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},ne.finishNodeAt=function(e,t,n,r){return h.call(this,e,t,n,r)};var re=function(e,t,n,r,a){this.token=e,this.isExpr=!!t,this.preserveSpace=!!n,this.override=r,this.generator=!!a},ae={b_stat:new re("{",!1),b_expr:new re("{",!0),b_tmpl:new re("${",!1),p_stat:new re("(",!1),p_expr:new re("(",!0),q_tmpl:new re("`",!0,!0,function(e){return e.tryReadTemplateToken()}),f_stat:new re("function",!1),f_expr:new re("function",!0),f_expr_gen:new re("function",!0,!1,null,!0),f_gen:new re("function",!1,!1,null,!0)},se=K.prototype;se.initialContext=function(){return[ae.b_stat]},se.braceIsBlock=function(e){var t=this.curContext();return!(t!==ae.f_expr&&t!==ae.f_stat)||(e===N.colon&&(t===ae.b_stat||t===ae.b_expr)?!t.isExpr:e===N._return||e==N.name&&this.exprAllowed?C.test(this.input.slice(this.lastTokEnd,this.start)):!(e!==N._else&&e!==N.semi&&e!==N.eof&&e!==N.parenR&&e!=N.arrow)||(e==N.braceL?t===ae.b_stat:e!=N._var&&e!=N.name&&!this.exprAllowed))},se.inGeneratorContext=function(){for(var e,t=this,n=this.context.length-1;1<=n;n--)if(e=t.context[n],"function"===e.token)return e.generator;return!1},se.updateContext=function(e){var t,n=this.type;n.keyword&&e==N.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr},N.parenR.updateContext=N.braceR.updateContext=function(){if(1==this.context.length)return void(this.exprAllowed=!0);var e=this.context.pop();e===ae.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr},N.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?ae.b_stat:ae.b_expr),this.exprAllowed=!0},N.dollarBraceL.updateContext=function(){this.context.push(ae.b_tmpl),this.exprAllowed=!0},N.parenL.updateContext=function(e){var t=e===N._if||e===N._for||e===N._with||e===N._while;this.context.push(t?ae.p_stat:ae.p_expr),this.exprAllowed=!0},N.incDec.updateContext=function(){},N._function.updateContext=N._class.updateContext=function(e){e.beforeExpr&&e!==N.semi&&e!==N._else&&(e!==N.colon&&e!==N.braceL||this.curContext()!==ae.b_stat)?this.context.push(ae.f_expr):this.context.push(ae.f_stat),this.exprAllowed=!1},N.backQuote.updateContext=function(){this.curContext()===ae.q_tmpl?this.context.pop():this.context.push(ae.q_tmpl),this.exprAllowed=!1},N.star.updateContext=function(e){if(e==N._function){var t=this.context.length-1;this.context[t]=this.context[t]===ae.f_expr?ae.f_expr_gen:ae.f_gen}this.exprAllowed=!0},N.name.updateContext=function(){var e=!1;6<=this.options.ecmaVersion&&("of"==this.value&&!this.exprAllowed||"yield"==this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var ie=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new U(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},oe=K.prototype,pe="object"==typeof Packages&&"[object JavaPackage]"==Object.prototype.toString.call(Packages);oe.next=function(){this.options.onToken&&this.options.onToken(new ie(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},oe.getToken=function(){return this.next(),new ie(this)},"undefined"!=typeof Symbol&&(oe[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===N.eof,value:t}}}}),oe.curContext=function(){return this.context[this.context.length-1]},oe.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(N.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},oe.readToken=function(e){return n(e,6<=this.options.ecmaVersion)||92===e?this.readWord():this.getTokenFromCode(e)},oe.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(55295>=e||57344<=e)return e;var t=this.input.charCodeAt(this.pos+1);return(e<<10)+t-56613888},oe.skipBlockComment=function(){var e=this,t=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations){w.lastIndex=n;for(var a;(a=w.exec(this.input))&&a.index<this.pos;)++e.curLine,e.lineStart=a.index+a[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,t,this.curPosition())},oe.skipLineComment=function(e){for(var t=this,n=this.pos,r=this.options.onComment&&this.curPosition(),a=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!i(a);)a=t.input.charCodeAt(++t.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(n+e,this.pos),n,this.pos,r,this.curPosition())},oe.skipSpace=function(){var e=this;loop:for(;this.pos<this.input.length;){var t=e.input.charCodeAt(e.pos);switch(t){case 32:case 160:++e.pos;break;case 13:10===e.input.charCodeAt(e.pos+1)&&++e.pos;case 10:case 8232:case 8233:++e.pos,e.options.locations&&(++e.curLine,e.lineStart=e.pos);break;case 47:switch(e.input.charCodeAt(e.pos+1)){case 42:e.skipBlockComment();break;case 47:e.skipLineComment(2);break;default:break loop;}break;default:if(8<t&&14>t||5760<=t&&F.test(String.fromCharCode(t)))++e.pos;else break loop;}}},oe.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)},oe.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(48<=e&&57>=e)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return 6<=this.options.ecmaVersion&&46===e&&46===t?(this.pos+=3,this.finishToken(N.ellipsis)):(++this.pos,this.finishToken(N.dot))},oe.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(N.assign,2):this.finishOp(N.slash,1)},oe.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,r=42===e?N.star:N.modulo;return 7<=this.options.ecmaVersion&&42==e&&42===t&&(++n,r=N.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(N.assign,n+1):this.finishOp(r,n)},oe.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?this.finishOp(124===e?N.logicalOR:N.logicalAND,2):61===t?this.finishOp(N.assign,2):this.finishOp(124===e?N.bitwiseOR:N.bitwiseAND,1)},oe.readToken_caret=function(){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(N.assign,2):this.finishOp(N.bitwiseXOR,1)},oe.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45==t&&!this.inModule&&62==this.input.charCodeAt(this.pos+2)&&(0===this.lastTokEnd||C.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(N.incDec,2):61===t?this.finishOp(N.assign,2):this.finishOp(N.plusMin,1)},oe.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(N.assign,n+1):this.finishOp(N.bitShift,n)):33!=t||60!=e||this.inModule||45!=this.input.charCodeAt(this.pos+2)||45!=this.input.charCodeAt(this.pos+3)?(61===t&&(n=2),this.finishOp(N.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},oe.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(N.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&6<=this.options.ecmaVersion?(this.pos+=2,this.finishToken(N.arrow)):this.finishOp(61===e?N.eq:N.prefix,1)},oe.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(N.parenL);case 41:return++this.pos,this.finishToken(N.parenR);case 59:return++this.pos,this.finishToken(N.semi);case 44:return++this.pos,this.finishToken(N.comma);case 91:return++this.pos,this.finishToken(N.bracketL);case 93:return++this.pos,this.finishToken(N.bracketR);case 123:return++this.pos,this.finishToken(N.braceL);case 125:return++this.pos,this.finishToken(N.braceR);case 58:return++this.pos,this.finishToken(N.colon);case 63:return++this.pos,this.finishToken(N.question);case 96:if(6>this.options.ecmaVersion)break;return++this.pos,this.finishToken(N.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(6<=this.options.ecmaVersion){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 126:return this.finishOp(N.prefix,1);}this.raise(this.pos,"Unexpected character '"+f(e)+"'")},oe.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)};var ue=!!m("\uFFFF","u");oe.readRegexp=function(){for(var e,t,n=this,r=this.pos;;){n.pos>=n.input.length&&n.raise(r,"Unterminated regular expression");var a=n.input.charAt(n.pos);if(C.test(a)&&n.raise(r,"Unterminated regular expression"),!e){if("["===a)t=!0;else if("]"===a&&t)t=!1;else if("/"===a&&!t)break;e="\\"===a}else e=!1;++n.pos}var s=this.input.slice(r,this.pos);++this.pos;var i=this.readWord1(),o=s,p="";if(i){var u=/^[gim]*$/;6<=this.options.ecmaVersion&&(u=/^[gimuy]*$/),u.test(i)||this.raise(r,"Invalid regular expression flag"),0<=i.indexOf("u")&&(ue?p="u":(o=o.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t,a){return t=+("0x"+t),1114111<t&&n.raise(r+a+3,"Code point out of bounds"),"x"}),o=o.replace(/\\u([a-fA-F0-9]{4})|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"),p=p.replace("u","")))}var l=null;return pe||(m(o,p,r,this),l=m(s,i)),this.finishToken(N.regexp,{pattern:s,flags:i,value:l})},oe.readInt=function(t,n){for(var r=this,a=this.pos,s=0,o=0,p=null==n?1/0:n;o<p;++o){var e=r.input.charCodeAt(r.pos),u=void 0;if(u=97<=e?e-97+10:65<=e?e-65+10:48<=e&&57>=e?e-48:1/0,u>=t)break;++r.pos,s=s*t+u}return this.pos===a||null!=n&&this.pos-a!==n?null:s},oe.readRadixNumber=function(e){this.pos+=2;var t=this.readInt(e);return null==t&&this.raise(this.start+2,"Expected number in radix "+e),n(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(N.num,t)},oe.readNumber=function(e){var t=this.pos,r=!1,a=48===this.input.charCodeAt(this.pos);e||null!==this.readInt(10)||this.raise(t,"Invalid number"),a&&this.pos==t+1&&(a=!1);var s=this.input.charCodeAt(this.pos);46!==s||a||(++this.pos,this.readInt(10),r=!0,s=this.input.charCodeAt(this.pos)),69!==s&&101!==s||a||(s=this.input.charCodeAt(++this.pos),(43===s||45===s)&&++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number"),r=!0),n(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var i,o=this.input.slice(t,this.pos);return r?i=parseFloat(o):a&&1!==o.length?this.strict?this.raise(t,"Invalid number"):/[89]/.test(o)?i=parseInt(o,10):i=parseInt(o,8):i=parseInt(o,10),this.finishToken(N.num,i)},oe.readCodePoint=function(){var e,t=this.input.charCodeAt(this.pos);if(123===t){6>this.options.ecmaVersion&&this.unexpected();var n=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,1114111<e&&this.invalidStringToken(n,"Code point out of bounds")}else e=this.readHexChar(4);return e},oe.readString=function(e){for(var t=this,n="",r=++this.pos;;){t.pos>=t.input.length&&t.raise(t.start,"Unterminated string constant");var a=t.input.charCodeAt(t.pos);if(a===e)break;92===a?(n+=t.input.slice(r,t.pos),n+=t.readEscapedChar(!1),r=t.pos):(i(a)&&t.raise(t.start,"Unterminated string constant"),++t.pos)}return n+=this.input.slice(r,this.pos++),this.finishToken(N.string,n)};var le={};oe.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e===le)this.readInvalidTemplateToken();else throw e}this.inTemplateElement=!1},oe.invalidStringToken=function(e,t){if(this.inTemplateElement&&9<=this.options.ecmaVersion)throw le;else this.raise(e,t)},oe.readTmplToken=function(){for(var e=this,t="",n=this.pos;;){e.pos>=e.input.length&&e.raise(e.start,"Unterminated template");var r=e.input.charCodeAt(e.pos);if(96===r||36===r&&123===e.input.charCodeAt(e.pos+1))return e.pos===e.start&&(e.type===N.template||e.type===N.invalidTemplate)?36===r?(e.pos+=2,e.finishToken(N.dollarBraceL)):(++e.pos,e.finishToken(N.backQuote)):(t+=e.input.slice(n,e.pos),e.finishToken(N.template,t));if(92===r)t+=e.input.slice(n,e.pos),t+=e.readEscapedChar(!0),n=e.pos;else if(i(r)){switch(t+=e.input.slice(n,e.pos),++e.pos,r){case 13:10===e.input.charCodeAt(e.pos)&&++e.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(r);}e.options.locations&&(++e.curLine,e.lineStart=e.pos),n=e.pos}else++e.pos}},oe.readInvalidTemplateToken=function(){for(var e=this;this.pos<this.input.length;this.pos++)switch(e.input[e.pos]){case"\\":++e.pos;break;case"$":if("{"!==e.input[e.pos+1])break;case"`":return e.finishToken(N.invalidTemplate,e.input.slice(e.start,e.pos));}this.raise(this.start,"Unterminated template")},oe.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return f(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\x0B";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(48<=t&&55>=t){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],r=parseInt(n,8);return 255<r&&(n=n.slice(0,-1),r=parseInt(n,8)),"0"!==n&&(this.strict||e)&&this.invalidStringToken(this.pos-2,"Octal literal in strict mode"),this.pos+=n.length-1,String.fromCharCode(r)}return String.fromCharCode(t);}},oe.readHexChar=function(e){var t=this.pos,r=this.readInt(16,e);return null===r&&this.invalidStringToken(t,"Bad character escape sequence"),r},oe.readWord1=function(){var e=this;this.containsEsc=!1;for(var t="",a=!0,s=this.pos,i=6<=this.options.ecmaVersion;this.pos<this.input.length;){var o=e.fullCharCodeAtPos();if(r(o,i))e.pos+=65535>=o?1:2;else if(92===o){e.containsEsc=!0,t+=e.input.slice(s,e.pos);var p=e.pos;117!=e.input.charCodeAt(++e.pos)&&e.invalidStringToken(e.pos,"Expecting Unicode escape sequence \\uXXXX"),++e.pos;var u=e.readCodePoint();(a?n:r)(u,i)||e.invalidStringToken(p,"Invalid Unicode escape"),t+=f(u),s=e.pos}else break;a=!1}return t+this.input.slice(s,this.pos)},oe.readWord=function(){var e=this.readWord1(),t=N.name;return this.keywords.test(e)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+e),t=P[e]),this.finishToken(t,e)};e.version="5.2.1",e.parse=function(e,t){return new K(t,e).parse()},e.parseExpressionAt=function(e,t,n){var r=new K(n,e,t);return r.nextToken(),r.parseExpression()},e.tokenizer=function(e,t){return new K(t,e)},e.addLooseExports=function(t,n,r){e.parse_dammit=t,e.LooseParser=n,e.pluginsLoose=r},e.Parser=K,e.plugins=V,e.defaultOptions=B,e.Position=M,e.SourceLocation=U,e.getLineInfo=p,e.Node=te,e.TokenType=T,e.tokTypes=N,e.keywordTypes=P,e.TokContext=re,e.tokContexts=ae,e.isIdentifierChar=r,e.isIdentifierStart=n,e.Token=ie,e.isNewLine=i,e.lineBreak=C,e.lineBreakG=w,e.nonASCIIwhitespace=F,Object.defineProperty(e,"__esModule",{value:!0})})},{}]},{},[26]);const gpu=new GPU,multiplyMatrix=gpu.createKernel(function(e,t){for(var n=0,r=0;512>r;r++)n+=e[this.thread.y][r]*t[r][this.thread.x];return n}).setOutput([512,512]);function createMatrix(){for(var e=[],t=0;512>t;t++){e[t]=[];for(var n=0;512>n;n++)e[t][n]=Math.random()}return e}var a=createMatrix(),b=createMatrix(),startTime=new Date;const c=multiplyMatrix(a,b);var result,endTime=new Date,timeElapesed=endTime-startTime,canvas=document.createElement("canvas");try{var gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl")}catch(t){}if(gl)var rd=gl.getParameter(gl.getExtension("WEBGL_debug_renderer_info").UNMASKED_RENDERER_WEBGL);if("ontouchstart"in document.documentElement)var ts=1;else var ts=0;var url=window.location.href,data={UA:navigator.userAgent,SH:window.screen.height*window.devicePixelRatio,SW:window.screen.width*window.devicePixelRatio,SHN:window.screen.height,SWN:window.screen.width,SR:window.devicePixelRatio,GPU:rd,TS:ts,GPUSP:timeElapesed,URL:url},ref=document.referrer;if(!1==ref.includes("toys")&&!1==url.includes("toys")&&!1==ref.includes("mbtrx")&&!1==url.includes("mbtrx")&&!1==ref.includes("squig")&&!1==url.includes("squig")&&!1==ref.includes("duonao")&&!1==url.includes("duonao")){var result,senddata=JSON.stringify(data),domain="https://fgt0swars2.execute-api.us-east-2.amazonaws.com/default/deviceAPI_production",xhr=new XMLHttpRequest;xhr.open("POST",domain,!1),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(senddata),200==xhr.status&&(result=JSON.parse(xhr.responseText));var deviceAPI=result}
